2025-07-10 08:53:29.502 -03:00 [INF] Sistema iniciado em 10/07/2025 08:53:29
2025-07-10 08:53:29.567 -03:00 [INF] Creating key {0c434f62-133c-4e49-83fd-aee087480d56} with creation date 2025-07-10 11:53:29Z, activation date 2025-07-10 11:53:29Z, and expiration date 2025-10-08 11:53:29Z.
2025-07-10 08:53:29.578 -03:00 [WRN] No XML encryptor configured. Key {0c434f62-133c-4e49-83fd-aee087480d56} may be persisted to storage in unencrypted form.
2025-07-10 08:53:29.581 -03:00 [INF] Writing data to file 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\DataProtection-Keys\key-0c434f62-133c-4e49-83fd-aee087480d56.xml'.
2025-07-10 08:53:29.620 -03:00 [INF] Now listening on: http://localhost:5000
2025-07-10 08:53:29.622 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-10 08:53:29.623 -03:00 [INF] Hosting environment: Development
2025-07-10 08:53:29.624 -03:00 [INF] Content root path: F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev
2025-07-10 08:53:33.518 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/ - null null
2025-07-10 08:53:33.562 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.HomeController.Index (site.diogocosta.dev)'
2025-07-10 08:53:33.583 -03:00 [INF] Route matched with {action = "Index", controller = "Home"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Index() on controller site.diogocosta.dev.Controllers.HomeController (site.diogocosta.dev).
2025-07-10 08:53:33.598 -03:00 [INF] Executing ViewResult, running view Index.
2025-07-10 08:53:33.715 -03:00 [INF] Executed ViewResult - view Index executed in 118.0082ms.
2025-07-10 08:53:33.726 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.HomeController.Index (site.diogocosta.dev) in 140.4849ms
2025-07-10 08:53:33.727 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.HomeController.Index (site.diogocosta.dev)'
2025-07-10 08:53:33.730 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/ - 200 null text/html; charset=utf-8 213.7114ms
2025-07-10 08:53:33.751 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/IMG_0045.webp - null null
2025-07-10 08:53:33.751 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/js/newsletter.js - null null
2025-07-10 08:53:33.770 -03:00 [INF] Sending file. Request path: '/js/newsletter.js'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\js\newsletter.js'
2025-07-10 08:53:33.770 -03:00 [INF] Sending file. Request path: '/img/IMG_0045.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\IMG_0045.webp'
2025-07-10 08:53:33.774 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/js/newsletter.js - 200 5883 text/javascript 22.7221ms
2025-07-10 08:53:33.775 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/IMG_0045.webp - 200 43926 image/webp 24.8485ms
2025-07-10 08:53:34.150 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/1.webp - null null
2025-07-10 08:53:34.151 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/6.webp - null null
2025-07-10 08:53:34.154 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/3.webp - null null
2025-07-10 08:53:34.154 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/4.webp - null null
2025-07-10 08:53:34.155 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/5.webp - null null
2025-07-10 08:53:34.155 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/7.webp - null null
2025-07-10 08:53:34.156 -03:00 [INF] Sending file. Request path: '/img/1.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\1.webp'
2025-07-10 08:53:34.158 -03:00 [INF] Sending file. Request path: '/img/6.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\6.webp'
2025-07-10 08:53:34.161 -03:00 [INF] Sending file. Request path: '/img/3.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\3.webp'
2025-07-10 08:53:34.164 -03:00 [INF] Sending file. Request path: '/img/4.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\4.webp'
2025-07-10 08:53:34.167 -03:00 [INF] Sending file. Request path: '/img/5.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\5.webp'
2025-07-10 08:53:34.169 -03:00 [INF] Sending file. Request path: '/img/7.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\7.webp'
2025-07-10 08:53:34.170 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/1.webp - 200 6562 image/webp 19.4673ms
2025-07-10 08:53:34.171 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/6.webp - 200 7306 image/webp 20.8428ms
2025-07-10 08:53:34.173 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/3.webp - 200 4492 image/webp 19.1465ms
2025-07-10 08:53:34.174 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/4.webp - 200 8996 image/webp 20.1847ms
2025-07-10 08:53:34.175 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/5.webp - 200 8740 image/webp 20.1123ms
2025-07-10 08:53:34.176 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/7.webp - 200 4522 image/webp 21.0809ms
2025-07-10 08:53:34.178 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/8.webp - null null
2025-07-10 08:53:34.181 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/9.webp - null null
2025-07-10 08:53:34.182 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/11.webp - null null
2025-07-10 08:53:34.184 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/14.webp - null null
2025-07-10 08:53:34.187 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/10.webp - null null
2025-07-10 08:53:34.190 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/12.webp - null null
2025-07-10 08:53:34.194 -03:00 [INF] Sending file. Request path: '/img/8.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\8.webp'
2025-07-10 08:53:34.209 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/8.webp - 200 11264 image/webp 30.7515ms
2025-07-10 08:53:34.201 -03:00 [INF] Sending file. Request path: '/img/11.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\11.webp'
2025-07-10 08:53:34.202 -03:00 [INF] Sending file. Request path: '/img/14.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\14.webp'
2025-07-10 08:53:34.205 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/manifest.json?v=4 - null null
2025-07-10 08:53:34.205 -03:00 [INF] Sending file. Request path: '/img/10.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\10.webp'
2025-07-10 08:53:34.208 -03:00 [INF] Sending file. Request path: '/img/12.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\12.webp'
2025-07-10 08:53:34.197 -03:00 [INF] Sending file. Request path: '/img/9.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\9.webp'
2025-07-10 08:53:34.213 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/13.webp - null null
2025-07-10 08:53:34.215 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/11.webp - 200 5346 image/webp 32.6977ms
2025-07-10 08:53:34.217 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/14.webp - 200 7290 image/webp 32.5197ms
2025-07-10 08:53:34.222 -03:00 [INF] Sending file. Request path: '/manifest.json'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\manifest.json'
2025-07-10 08:53:34.223 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/10.webp - 200 7788 image/webp 36.3292ms
2025-07-10 08:53:34.225 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/12.webp - 200 4880 image/webp 34.7563ms
2025-07-10 08:53:34.227 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/9.webp - 200 13526 image/webp 46.4805ms
2025-07-10 08:53:34.231 -03:00 [INF] Sending file. Request path: '/img/13.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\13.webp'
2025-07-10 08:53:34.240 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/manifest.json?v=4 - 200 646 application/json 35.6609ms
2025-07-10 08:53:34.247 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/D_180.png - null null
2025-07-10 08:53:34.251 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/13.webp - 200 9486 image/webp 37.2171ms
2025-07-10 08:53:34.256 -03:00 [INF] Sending file. Request path: '/img/D_180.png'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\D_180.png'
2025-07-10 08:53:34.260 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/D_180.png - 200 3792 image/png 12.9729ms
2025-07-10 08:53:36.328 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/desbloqueio - null null
2025-07-10 08:53:36.331 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Index (site.diogocosta.dev)'
2025-07-10 08:53:36.333 -03:00 [INF] Route matched with {action = "Index", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Index() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 08:53:36.660 -03:00 [INF] Executing ViewResult, running view Index.
2025-07-10 08:53:36.682 -03:00 [INF] Executed ViewResult - view Index executed in 22.6489ms.
2025-07-10 08:53:36.683 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Index (site.diogocosta.dev) in 349.0562ms
2025-07-10 08:53:36.684 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Index (site.diogocosta.dev)'
2025-07-10 08:53:36.688 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/desbloqueio - 200 null text/html; charset=utf-8 359.6015ms
2025-07-10 08:53:54.638 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 228
2025-07-10 08:53:54.642 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 08:53:54.648 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 08:53:54.669 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: diogo@codigocentral.com.br, Nome: Diogo
2025-07-10 08:53:54.678 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: ::1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36
2025-07-10 08:53:54.679 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 08:53:54.680 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: diogo@codigocentral.com.br, Slug: manual-primeira-virada
2025-07-10 08:53:55.222 -03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-10 08:53:57.896 -03:00 [INF] Executed DbCommand (300ms) [Parameters=[@__ToLower_0='diogo@codigocentral.com.br', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 08:53:58.239 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 08:53:58.650 -03:00 [ERR] Failed executing DbCommand (268ms) [Parameters=[@p0='2025-07-10T11:53:58.3425349Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='diogo@codigocentral.com.br' (Nullable = false), @p3='::1', @p4='Diogo' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T11:53:58.3425580Z' (DbType = DateTime), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 08:53:58.665 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'site.diogocosta.dev.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42804: column "ip_address" is of type inet but expression is of type text

POSITION: 230
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42804
    MessageText: column "ip_address" is of type inet but expression is of type text
    Hint: You will need to rewrite or cast the expression.
    Position: 230
    File: parse_target.c
    Line: 587
    Routine: transformAssignedExpr
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42804: column "ip_address" is of type inet but expression is of type text

POSITION: 230
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42804
    MessageText: column "ip_address" is of type inet but expression is of type text
    Hint: You will need to rewrite or cast the expression.
    Position: 230
    File: parse_target.c
    Line: 587
    Routine: transformAssignedExpr
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-10 08:53:58.691 -03:00 [ERR] Erro ao criar lead: diogo@codigocentral.com.br para manual-primeira-virada
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42804: column "ip_address" is of type inet but expression is of type text

POSITION: 230
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42804
    MessageText: column "ip_address" is of type inet but expression is of type text
    Hint: You will need to rewrite or cast the expression.
    Position: 230
    File: parse_target.c
    Line: 587
    Routine: transformAssignedExpr
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 199
   at site.diogocosta.dev.Servicos.LeadService.CriarLeadAsync(CriarLeadRequest request, String ipAddress, String userAgent) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 84
2025-07-10 08:53:58.703 -03:00 [WRN] ⚠️ Falha ao criar lead para diogo@codigocentral.com.br, mas continuando com o processo
2025-07-10 08:53:58.711 -03:00 [INF] Iniciando cadastro de usuário na newsletter: diogo@codigocentral.com.br
2025-07-10 08:53:58.723 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 08:53:58.725 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 08:53:59.660 -03:00 [INF] Received HTTP response headers after 932.3861ms - 200
2025-07-10 08:53:59.661 -03:00 [INF] End processing HTTP request after 939.0755ms - 200
2025-07-10 08:53:59.662 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: diogo@codigocentral.com.br
2025-07-10 08:54:18.007 -03:00 [INF] ✅ Email enviado com sucesso para diogo@codigocentral.com.br - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 08:54:18.009 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'diogo@codigocentral.com.br'
2025-07-10 08:54:18.010 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'Diogo'
2025-07-10 08:54:18.010 -03:00 [INF] Usuário Diogo (diogo@codigocentral.com.br) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 08:54:18.014 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 08:54:18.015 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 23365.6872ms
2025-07-10 08:54:18.016 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 08:54:18.020 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 23382.0712ms
2025-07-10 08:54:18.023 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - null null
2025-07-10 08:54:18.025 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 08:54:18.026 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 08:54:18.033 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'diogo@codigocentral.com.br'
2025-07-10 08:54:18.034 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'Diogo'
2025-07-10 08:54:18.037 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 08:54:18.041 -03:00 [INF] Executed ViewResult - view Obrigado executed in 4.0448ms.
2025-07-10 08:54:18.042 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 13.7117ms
2025-07-10 08:54:18.043 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 08:54:18.045 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 21.8085ms
2025-07-10 09:04:38.401 -03:00 [INF] Sistema iniciado em 10/07/2025 09:04:38
2025-07-10 09:04:38.472 -03:00 [INF] Now listening on: http://localhost:5000
2025-07-10 09:04:38.475 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-10 09:04:38.476 -03:00 [INF] Hosting environment: Development
2025-07-10 09:04:38.476 -03:00 [INF] Content root path: f:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev
2025-07-10 09:05:12.215 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/manual-primeira-virada?id=5290c3db-235f-4029-88f7-de7cb8bd8514&vscodeBrowserReqId=1752149112181 - null null
2025-07-10 09:05:12.251 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/manual-primeira-virada?id=5290c3db-235f-4029-88f7-de7cb8bd8514&vscodeBrowserReqId=1752149112181 - 404 0 null 36.0659ms
2025-07-10 09:05:12.267 -03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:5000/manual-primeira-virada, Response status code: 404
2025-07-10 09:05:39.032 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/desafio-vendas?id=6db18142-0a6d-4307-9ced-70a151bf250c&vscodeBrowserReqId=1752149139026 - null null
2025-07-10 09:05:39.037 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesafiosController.Index (site.diogocosta.dev)'
2025-07-10 09:05:39.055 -03:00 [INF] Route matched with {action = "Index", controller = "Desafios"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Index(System.String) on controller site.diogocosta.dev.Controllers.DesafiosController (site.diogocosta.dev).
2025-07-10 09:05:39.153 -03:00 [INF] Executing ViewResult, running view Index.
2025-07-10 09:05:39.197 -03:00 [INF] Executed ViewResult - view Index executed in 45.7002ms.
2025-07-10 09:05:39.199 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesafiosController.Index (site.diogocosta.dev) in 141.8195ms
2025-07-10 09:05:39.201 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesafiosController.Index (site.diogocosta.dev)'
2025-07-10 09:05:39.205 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/desafio-vendas?id=6db18142-0a6d-4307-9ced-70a151bf250c&vscodeBrowserReqId=1752149139026 - 200 null text/html; charset=utf-8 173.8785ms
2025-07-10 09:06:04.187 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/leads/health - null null
2025-07-10 09:06:04.190 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.LeadsController.Health (site.diogocosta.dev)'
2025-07-10 09:06:04.192 -03:00 [INF] Route matched with {action = "Health", controller = "Leads"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Health() on controller site.diogocosta.dev.Controllers.LeadsController (site.diogocosta.dev).
2025-07-10 09:06:04.198 -03:00 [INF] Executing JsonResult, writing value of type '<>f__AnonymousType14`4[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-10 09:06:04.212 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.LeadsController.Health (site.diogocosta.dev) in 18.961ms
2025-07-10 09:06:04.213 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.LeadsController.Health (site.diogocosta.dev)'
2025-07-10 09:06:04.214 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/leads/health - 200 null application/json; charset=utf-8 26.5299ms
2025-07-10 09:06:19.275 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desafios/CapturarLead - application/x-www-form-urlencoded 61
2025-07-10 09:06:19.276 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesafiosController.CapturarLead (site.diogocosta.dev)'
2025-07-10 09:06:19.283 -03:00 [INF] Route matched with {action = "CapturarLead", controller = "Desafios"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CapturarLead(site.diogocosta.dev.Models.DesafioLeadModel) on controller site.diogocosta.dev.Controllers.DesafiosController (site.diogocosta.dev).
2025-07-10 09:06:19.610 -03:00 [ERR] Erro ao criar lead: teste@exemplo.com para desafio-vendas
System.InvalidOperationException: The 'string' property 'LeadInteractionModel.IpAddress' could not be mapped to the database type 'inet' because the database provider does not support mapping 'string' properties to 'inet' columns. Consider mapping to a different database type or converting the property value to a type supported by the database using a value converter. See https://aka.ms/efcore-docs-value-converters for more information. Alternately, exclude the property from the model using the '[NotMapped]' attribute or by using 'EntityTypeBuilder.Ignore' in 'OnModelCreating'.
   at Microsoft.EntityFrameworkCore.Infrastructure.RelationalModelValidator.ThrowPropertyNotMappedException(String propertyType, IConventionTypeBase typeBase, IConventionProperty unmappedProperty)
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelValidator.<ValidatePropertyMapping>g__Validate|7_0(IConventionTypeBase typeBase, <>c__DisplayClass7_0&)
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelValidator.ValidatePropertyMapping(IModel model, IDiagnosticsLogger`1 logger)
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelValidator.Validate(IModel model, IDiagnosticsLogger`1 logger)
   at Microsoft.EntityFrameworkCore.Infrastructure.RelationalModelValidator.Validate(IModel model, IDiagnosticsLogger`1 logger)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Infrastructure.Internal.NpgsqlModelValidator.Validate(IModel model, IDiagnosticsLogger`1 logger)
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelRuntimeInitializer.Initialize(IModel model, Boolean designTime, IDiagnosticsLogger`1 validationLogger)
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelSource.GetModel(DbContext context, ModelCreationDependencies modelCreationDependencies, Boolean designTime)
   at Microsoft.EntityFrameworkCore.Internal.DbContextServices.CreateModel(Boolean designTime)
   at Microsoft.EntityFrameworkCore.Internal.DbContextServices.get_Model()
   at Microsoft.EntityFrameworkCore.Infrastructure.EntityFrameworkServicesBuilder.<>c.<TryAddCoreServices>b__8_4(IServiceProvider p)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.DynamicServiceProviderEngine.<>c__DisplayClass2_0.<RealizeService>b__0(ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.get_ContextServices()
   at Microsoft.EntityFrameworkCore.DbContext.get_Model()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.get_EntityType()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.CheckState()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.get_EntityQueryable()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.System.Linq.IQueryable.get_Provider()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.Include[TEntity,TProperty](IQueryable`1 source, Expression`1 navigationPropertyPath)
   at site.diogocosta.dev.Servicos.LeadService.BuscarLeadAsync(String email, String desafioSlug) in f:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 112
   at site.diogocosta.dev.Servicos.LeadService.CriarLeadAsync(CriarLeadRequest request, String ipAddress, String userAgent) in f:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 40
2025-07-10 09:06:19.623 -03:00 [ERR] Falha ao criar lead: teste@exemplo.com para desafio-vendas
2025-07-10 09:06:19.624 -03:00 [ERR] Erro ao capturar lead: teste@exemplo.com para desafio-vendas
System.Exception: Falha ao processar lead
   at site.diogocosta.dev.Controllers.DesafiosController.CapturarLead(DesafioLeadModel model) in f:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Controllers\DesafiosController.cs:line 217
2025-07-10 09:06:19.626 -03:00 [INF] Executing ViewResult, running view Index.
2025-07-10 09:06:19.630 -03:00 [INF] Executed ViewResult - view Index executed in 4.0367ms.
2025-07-10 09:06:19.631 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesafiosController.CapturarLead (site.diogocosta.dev) in 345.9243ms
2025-07-10 09:06:19.632 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesafiosController.CapturarLead (site.diogocosta.dev)'
2025-07-10 09:06:19.633 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desafios/CapturarLead - 200 null text/html; charset=utf-8 358.9675ms
2025-07-10 09:14:14.907 -03:00 [INF] Sistema iniciado em 10/07/2025 09:14:14
2025-07-10 09:14:14.973 -03:00 [INF] Now listening on: http://localhost:5000
2025-07-10 09:14:14.976 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-10 09:14:14.977 -03:00 [INF] Hosting environment: Development
2025-07-10 09:14:14.978 -03:00 [INF] Content root path: F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev
2025-07-10 09:14:50.641 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/leads - application/json 98
2025-07-10 09:14:50.667 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/leads - 404 0 null 26.6886ms
2025-07-10 09:14:50.679 -03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:5000/api/leads, Response status code: 404
2025-07-10 09:15:45.682 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/leads/health - null null
2025-07-10 09:15:45.686 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.LeadsController.Health (site.diogocosta.dev)'
2025-07-10 09:15:45.700 -03:00 [INF] Route matched with {action = "Health", controller = "Leads"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Health() on controller site.diogocosta.dev.Controllers.LeadsController (site.diogocosta.dev).
2025-07-10 09:15:45.766 -03:00 [INF] Executing JsonResult, writing value of type '<>f__AnonymousType14`4[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-10 09:15:45.781 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.LeadsController.Health (site.diogocosta.dev) in 78.2514ms
2025-07-10 09:15:45.782 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.LeadsController.Health (site.diogocosta.dev)'
2025-07-10 09:15:45.784 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/leads/health - 200 null application/json; charset=utf-8 102.3789ms
2025-07-10 09:15:56.374 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 51
2025-07-10 09:15:56.377 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 09:15:56.389 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 09:15:56.411 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: diogo@codigocentral.com.br, Nome: Diogo Costa
2025-07-10 09:15:56.416 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: ::1, UserAgent: Mozilla/5.0 (Windows NT; Windows NT 10.0; pt-BR) WindowsPowerShell/5.1.26100.4652
2025-07-10 09:15:56.417 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 09:15:56.418 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: diogo@codigocentral.com.br, Slug: manual-primeira-virada
2025-07-10 09:15:56.745 -03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-10 09:15:59.308 -03:00 [INF] Executed DbCommand (293ms) [Parameters=[@__ToLower_0='diogo@codigocentral.com.br', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 09:15:59.627 -03:00 [INF] Executed DbCommand (264ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 09:16:00.025 -03:00 [INF] Executed DbCommand (274ms) [Parameters=[@p0='2025-07-10T12:15:59.7140875Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='diogo@codigocentral.com.br' (Nullable = false), @p3='::1' (DbType = Object), @p4='Diogo Costa' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T12:15:59.7141140Z' (DbType = DateTime), @p11='Mozilla/5.0 (Windows NT; Windows NT 10.0; pt-BR) WindowsPowerShell/5.1.26100.4652', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 09:16:00.328 -03:00 [ERR] Failed executing DbCommand (266ms) [Parameters=[@p0='2025-07-10T12:16:00.0471053Z' (DbType = DateTime), @p1='{"desafio":"manual-primeira-virada","utm_source":null,"utm_medium":null,"utm_campaign":null}', @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='1', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 09:16:00.338 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'site.diogocosta.dev.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42804: column "dados" is of type jsonb but expression is of type text

POSITION: 127
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42804
    MessageText: column "dados" is of type jsonb but expression is of type text
    Hint: You will need to rewrite or cast the expression.
    Position: 127
    File: parse_target.c
    Line: 587
    Routine: transformAssignedExpr
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42804: column "dados" is of type jsonb but expression is of type text

POSITION: 127
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42804
    MessageText: column "dados" is of type jsonb but expression is of type text
    Hint: You will need to rewrite or cast the expression.
    Position: 127
    File: parse_target.c
    Line: 587
    Routine: transformAssignedExpr
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-10 09:16:00.348 -03:00 [ERR] Erro ao registrar interação para lead 1: form_submitted
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42804: column "dados" is of type jsonb but expression is of type text

POSITION: 127
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42804
    MessageText: column "dados" is of type jsonb but expression is of type text
    Hint: You will need to rewrite or cast the expression.
    Position: 127
    File: parse_target.c
    Line: 587
    Routine: transformAssignedExpr
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 199
   at site.diogocosta.dev.Servicos.LeadService.RegistrarInteracaoAsync(Int32 leadId, String tipo, String descricao, Object dados) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 155
2025-07-10 09:16:00.357 -03:00 [INF] Novo lead criado: diogo@codigocentral.com.br para manual-primeira-virada (ID: 1)
2025-07-10 09:16:00.358 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: diogo@codigocentral.com.br (ID: 1)
2025-07-10 09:16:00.361 -03:00 [INF] Iniciando cadastro de usuário na newsletter: diogo@codigocentral.com.br
2025-07-10 09:16:00.364 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 09:16:00.366 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 09:16:01.284 -03:00 [INF] Received HTTP response headers after 916.0114ms - 200
2025-07-10 09:16:01.285 -03:00 [INF] End processing HTTP request after 922.7759ms - 200
2025-07-10 09:16:01.286 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: diogo@codigocentral.com.br
2025-07-10 09:16:13.198 -03:00 [INF] ✅ Email enviado com sucesso para diogo@codigocentral.com.br - Assunto: 🔥 Diogo Costa, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 09:16:13.506 -03:00 [INF] Executed DbCommand (276ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 Diogo Costa, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='diogo@codigocentral.com.br' (Nullable = false), @p5='2025-07-10T12:16:13.2008851Z' (DbType = DateTime), @p6=NULL, @p7='1' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true), @p11='2025-07-10T12:16:00.0471053Z' (DbType = DateTime), @p12='{"desafio":"manual-primeira-virada","utm_source":null,"utm_medium":null,"utm_campaign":null}', @p13='Lead se cadastrou no desafio', @p14=NULL (DbType = Object), @p15='1', @p16='form_submitted' (Nullable = false), @p17=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17)
RETURNING id;
2025-07-10 09:16:13.781 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'site.diogocosta.dev.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42804: column "dados" is of type jsonb but expression is of type text

POSITION: 127
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Update.Internal.NpgsqlModificationCommandBatch.Consume(RelationalDataReader reader, Boolean async, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42804
    MessageText: column "dados" is of type jsonb but expression is of type text
    Hint: You will need to rewrite or cast the expression.
    Position: 127
    File: parse_target.c
    Line: 587
    Routine: transformAssignedExpr
   --- End of inner exception stack trace ---
   at Npgsql.EntityFrameworkCore.PostgreSQL.Update.Internal.NpgsqlModificationCommandBatch.Consume(RelationalDataReader reader, Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42804: column "dados" is of type jsonb but expression is of type text

POSITION: 127
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Update.Internal.NpgsqlModificationCommandBatch.Consume(RelationalDataReader reader, Boolean async, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42804
    MessageText: column "dados" is of type jsonb but expression is of type text
    Hint: You will need to rewrite or cast the expression.
    Position: 127
    File: parse_target.c
    Line: 587
    Routine: transformAssignedExpr
   --- End of inner exception stack trace ---
   at Npgsql.EntityFrameworkCore.PostgreSQL.Update.Internal.NpgsqlModificationCommandBatch.Consume(RelationalDataReader reader, Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-10 09:16:13.788 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 1
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42804: column "dados" is of type jsonb but expression is of type text

POSITION: 127
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Update.Internal.NpgsqlModificationCommandBatch.Consume(RelationalDataReader reader, Boolean async, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42804
    MessageText: column "dados" is of type jsonb but expression is of type text
    Hint: You will need to rewrite or cast the expression.
    Position: 127
    File: parse_target.c
    Line: 587
    Routine: transformAssignedExpr
   --- End of inner exception stack trace ---
   at Npgsql.EntityFrameworkCore.PostgreSQL.Update.Internal.NpgsqlModificationCommandBatch.Consume(RelationalDataReader reader, Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 199
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 250
2025-07-10 09:16:14.407 -03:00 [INF] ✅ Email enviado com sucesso para diogo@codigocentral.com.br - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 09:16:14.409 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'diogo@codigocentral.com.br'
2025-07-10 09:16:14.409 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'Diogo Costa'
2025-07-10 09:16:14.410 -03:00 [INF] Usuário Diogo Costa (diogo@codigocentral.com.br) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 09:16:14.421 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 09:16:14.424 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 18033.6036ms
2025-07-10 09:16:14.425 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 09:16:14.429 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 18055.0211ms
2025-07-10 09:16:14.431 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 09:16:14.433 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 09:16:14.434 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 09:16:14.441 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'diogo@codigocentral.com.br'
2025-07-10 09:16:14.442 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'Diogo Costa'
2025-07-10 09:16:14.464 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 09:16:14.514 -03:00 [INF] Executed ViewResult - view Obrigado executed in 51.8727ms.
2025-07-10 09:16:14.515 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 80.2692ms
2025-07-10 09:16:14.516 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 09:16:14.517 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 86.2659ms
2025-07-10 09:18:29.329 -03:00 [INF] Sistema iniciado em 10/07/2025 09:18:29
2025-07-10 09:18:29.393 -03:00 [INF] Now listening on: http://localhost:5000
2025-07-10 09:18:29.396 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-10 09:18:29.397 -03:00 [INF] Hosting environment: Development
2025-07-10 09:18:29.397 -03:00 [INF] Content root path: F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev
2025-07-10 09:18:41.486 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 57
2025-07-10 09:18:41.517 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 09:18:41.537 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 09:18:41.618 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: teste.final@codigocentral.com.br, Nome: Teste Final
2025-07-10 09:18:41.624 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: ::1, UserAgent: Mozilla/5.0 (Windows NT; Windows NT 10.0; pt-BR) WindowsPowerShell/5.1.26100.4652
2025-07-10 09:18:41.625 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 09:18:41.626 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: teste.final@codigocentral.com.br, Slug: manual-primeira-virada
2025-07-10 09:18:41.958 -03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-10 09:18:44.602 -03:00 [INF] Executed DbCommand (297ms) [Parameters=[@__ToLower_0='teste.final@codigocentral.com.br', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 09:18:44.928 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 09:18:45.329 -03:00 [INF] Executed DbCommand (274ms) [Parameters=[@p0='2025-07-10T12:18:45.0181161Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='teste.final@codigocentral.com.br' (Nullable = false), @p3='::1' (DbType = Object), @p4='Teste Final' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T12:18:45.0181396Z' (DbType = DateTime), @p11='Mozilla/5.0 (Windows NT; Windows NT 10.0; pt-BR) WindowsPowerShell/5.1.26100.4652', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 09:18:45.647 -03:00 [INF] Executed DbCommand (281ms) [Parameters=[@p0='2025-07-10T12:18:45.3440426Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='2', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 09:18:45.651 -03:00 [INF] Novo lead criado: teste.final@codigocentral.com.br para manual-primeira-virada (ID: 2)
2025-07-10 09:18:45.652 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: teste.final@codigocentral.com.br (ID: 2)
2025-07-10 09:18:45.654 -03:00 [INF] Iniciando cadastro de usuário na newsletter: teste.final@codigocentral.com.br
2025-07-10 09:18:45.658 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 09:18:45.660 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 09:18:45.923 -03:00 [INF] Executed DbCommand (264ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 09:18:46.550 -03:00 [INF] Received HTTP response headers after 888.446ms - 200
2025-07-10 09:18:46.555 -03:00 [INF] End processing HTTP request after 897.7009ms - 200
2025-07-10 09:18:46.556 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: teste.final@codigocentral.com.br
2025-07-10 09:18:52.679 -03:00 [INF] ✅ Email enviado com sucesso para teste.final@codigocentral.com.br - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 09:18:52.681 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'teste.final@codigocentral.com.br'
2025-07-10 09:18:52.682 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'Teste Final'
2025-07-10 09:18:52.683 -03:00 [INF] Usuário Teste Final (teste.final@codigocentral.com.br) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 09:18:52.695 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 09:18:52.699 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 11159.0151ms
2025-07-10 09:18:52.700 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 09:18:52.707 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 11221.278ms
2025-07-10 09:18:52.709 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 09:18:52.712 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 09:18:52.714 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 09:18:52.720 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'teste.final@codigocentral.com.br'
2025-07-10 09:18:52.721 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'Teste Final'
2025-07-10 09:18:52.744 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 09:18:52.805 -03:00 [INF] Executed ViewResult - view Obrigado executed in 63.4449ms.
2025-07-10 09:18:52.806 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 91.1246ms
2025-07-10 09:18:52.807 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 09:18:52.808 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 99.2151ms
2025-07-10 09:18:53.916 -03:00 [INF] ✅ Email enviado com sucesso para teste.final@codigocentral.com.br - Assunto: 🔥 Teste Final, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 09:18:53.930 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 2
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.CheckDisposed()
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.Microsoft.EntityFrameworkCore.Internal.IDbContextDependencies.get_StateManager()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.EntryWithoutDetectChanges(TEntity entity)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.Add(TEntity entity)
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 249
2025-07-10 19:01:41.087 -03:00 [INF] Sistema iniciado em 10/07/2025 19:01:41
2025-07-10 19:01:41.167 -03:00 [INF] Now listening on: http://localhost:5000
2025-07-10 19:01:41.171 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-10 19:01:41.172 -03:00 [INF] Hosting environment: Development
2025-07-10 19:01:41.172 -03:00 [INF] Content root path: F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev
2025-07-10 19:14:13.235 -03:00 [INF] Application is shutting down...
2025-07-10 19:17:01.501 -03:00 [INF] Sistema iniciado em 10/07/2025 19:17:01
2025-07-10 19:17:01.590 -03:00 [INF] Now listening on: http://localhost:5000
2025-07-10 19:17:01.593 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-10 19:17:01.594 -03:00 [INF] Hosting environment: Development
2025-07-10 19:17:01.594 -03:00 [INF] Content root path: F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev
2025-07-10 19:17:07.032 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/ - null null
2025-07-10 19:17:07.081 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.HomeController.Index (site.diogocosta.dev)'
2025-07-10 19:17:07.099 -03:00 [INF] Route matched with {action = "Index", controller = "Home"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Index() on controller site.diogocosta.dev.Controllers.HomeController (site.diogocosta.dev).
2025-07-10 19:17:07.116 -03:00 [INF] Executing ViewResult, running view Index.
2025-07-10 19:17:07.237 -03:00 [INF] Executed ViewResult - view Index executed in 122.1113ms.
2025-07-10 19:17:07.249 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.HomeController.Index (site.diogocosta.dev) in 147.8211ms
2025-07-10 19:17:07.251 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.HomeController.Index (site.diogocosta.dev)'
2025-07-10 19:17:07.254 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/ - 200 null text/html; charset=utf-8 223.2125ms
2025-07-10 19:17:07.318 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/IMG_0045.webp - null null
2025-07-10 19:17:07.319 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/js/newsletter.js - null null
2025-07-10 19:17:07.334 -03:00 [INF] Sending file. Request path: '/img/IMG_0045.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\IMG_0045.webp'
2025-07-10 19:17:07.334 -03:00 [INF] Sending file. Request path: '/js/newsletter.js'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\js\newsletter.js'
2025-07-10 19:17:07.337 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/IMG_0045.webp - 200 43926 image/webp 19.1526ms
2025-07-10 19:17:07.338 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/js/newsletter.js - 200 5883 text/javascript 18.8734ms
2025-07-10 19:17:07.616 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/1.webp - null null
2025-07-10 19:17:07.616 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/6.webp - null null
2025-07-10 19:17:07.618 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/4.webp - null null
2025-07-10 19:17:07.618 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/3.webp - null null
2025-07-10 19:17:07.619 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/5.webp - null null
2025-07-10 19:17:07.619 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/7.webp - null null
2025-07-10 19:17:07.620 -03:00 [INF] Sending file. Request path: '/img/1.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\1.webp'
2025-07-10 19:17:07.622 -03:00 [INF] Sending file. Request path: '/img/6.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\6.webp'
2025-07-10 19:17:07.626 -03:00 [INF] Sending file. Request path: '/img/4.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\4.webp'
2025-07-10 19:17:07.629 -03:00 [INF] Sending file. Request path: '/img/3.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\3.webp'
2025-07-10 19:17:07.631 -03:00 [INF] Sending file. Request path: '/img/5.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\5.webp'
2025-07-10 19:17:07.634 -03:00 [INF] Sending file. Request path: '/img/7.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\7.webp'
2025-07-10 19:17:07.636 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/1.webp - 200 6562 image/webp 19.8384ms
2025-07-10 19:17:07.637 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/6.webp - 200 7306 image/webp 20.824ms
2025-07-10 19:17:07.638 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/4.webp - 200 8996 image/webp 20.402ms
2025-07-10 19:17:07.639 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/3.webp - 200 4492 image/webp 21.4859ms
2025-07-10 19:17:07.641 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/5.webp - 200 8740 image/webp 22.1091ms
2025-07-10 19:17:07.643 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/7.webp - 200 4522 image/webp 23.6233ms
2025-07-10 19:17:07.646 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/8.webp - null null
2025-07-10 19:17:07.649 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/13.webp - null null
2025-07-10 19:17:07.652 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/11.webp - null null
2025-07-10 19:17:07.655 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/12.webp - null null
2025-07-10 19:17:07.658 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/9.webp - null null
2025-07-10 19:17:07.662 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/10.webp - null null
2025-07-10 19:17:07.666 -03:00 [INF] Sending file. Request path: '/img/8.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\8.webp'
2025-07-10 19:17:07.669 -03:00 [INF] Sending file. Request path: '/img/13.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\13.webp'
2025-07-10 19:17:07.672 -03:00 [INF] Sending file. Request path: '/img/11.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\11.webp'
2025-07-10 19:17:07.675 -03:00 [INF] Sending file. Request path: '/img/12.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\12.webp'
2025-07-10 19:17:07.678 -03:00 [INF] Sending file. Request path: '/img/9.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\9.webp'
2025-07-10 19:17:07.681 -03:00 [INF] Sending file. Request path: '/img/10.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\10.webp'
2025-07-10 19:17:07.682 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/8.webp - 200 11264 image/webp 35.9474ms
2025-07-10 19:17:07.683 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/13.webp - 200 9486 image/webp 34.2833ms
2025-07-10 19:17:07.685 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/11.webp - 200 5346 image/webp 33.4738ms
2025-07-10 19:17:07.687 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/12.webp - 200 4880 image/webp 31.8704ms
2025-07-10 19:17:07.689 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/9.webp - 200 13526 image/webp 30.2937ms
2025-07-10 19:17:07.690 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/10.webp - 200 7788 image/webp 27.7444ms
2025-07-10 19:17:07.693 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/img/14.webp - null null
2025-07-10 19:17:07.713 -03:00 [INF] Sending file. Request path: '/img/14.webp'. Physical path: 'F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\wwwroot\img\14.webp'
2025-07-10 19:17:07.714 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/img/14.webp - 200 7290 image/webp 21.0366ms
2025-07-10 19:38:24.512 -03:00 [INF] Sistema iniciado em 10/07/2025 19:38:24
2025-07-10 19:38:24.585 -03:00 [INF] 🤖 Bot Detector Background Service iniciado!
2025-07-10 19:38:24.589 -03:00 [INF] 📊 Configurações: IP Threshold=10, UserAgent Threshold=15, Análise a cada "00:05:00"
2025-07-10 19:38:25.092 -03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-10 19:38:25.492 -03:00 [INF] Now listening on: https://localhost:5001
2025-07-10 19:38:25.493 -03:00 [INF] Now listening on: http://localhost:5000
2025-07-10 19:38:25.494 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-10 19:38:25.494 -03:00 [INF] Hosting environment: Development
2025-07-10 19:38:25.495 -03:00 [INF] Content root path: F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev
2025-07-10 19:38:27.651 -03:00 [INF] Executed DbCommand (298ms) [Parameters=[@__recentCutoff_0='2025-07-10T22:08:24.6863881Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.dados, l.descricao, l.ip_address, l.lead_id, l.tipo, l.user_agent
FROM leads_system.lead_interactions AS l
WHERE l.created_at >= @__recentCutoff_0
2025-07-10 19:39:00.783 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/antispam - application/json null
2025-07-10 19:39:00.823 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev)'
2025-07-10 19:39:00.842 -03:00 [INF] Route matched with {action = "GetRules", controller = "AntiSpam"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[site.diogocosta.dev.Models.AntiSpamRuleResponse]]] GetRules(System.String, System.Nullable`1[System.Boolean], System.String, Int32, Int32) on controller site.diogocosta.dev.Controllers.AntiSpamController (site.diogocosta.dev).
2025-07-10 19:39:01.161 -03:00 [INF] Executed DbCommand (274ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM public.antispam_rules AS a
2025-07-10 19:39:01.443 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[@__p_1='50', @__p_0='0'], CommandType='"Text"', CommandTimeout='30']
SELECT a.id AS "Id", a.rule_type AS "RuleType", a.rule_value AS "RuleValue", a.description AS "Description", a.severity AS "Severity", a.is_active AS "IsActive", a.is_regex AS "IsRegex", a.created_at AS "CreatedAt", a.updated_at AS "UpdatedAt", a.created_by AS "CreatedBy", a.detection_count AS "DetectionCount", a.last_detection AS "LastDetection"
FROM public.antispam_rules AS a
ORDER BY a.created_at DESC
LIMIT @__p_1 OFFSET @__p_0
2025-07-10 19:39:01.451 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[site.diogocosta.dev.Models.AntiSpamRuleResponse, site.diogocosta.dev, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-10 19:39:01.475 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev) in 630.316ms
2025-07-10 19:39:01.480 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev)'
2025-07-10 19:39:01.484 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/antispam - 200 null application/json; charset=utf-8 703.3741ms
2025-07-10 19:39:31.341 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/antispam - null null
2025-07-10 19:39:31.347 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev)'
2025-07-10 19:39:31.348 -03:00 [INF] Route matched with {action = "GetRules", controller = "AntiSpam"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[site.diogocosta.dev.Models.AntiSpamRuleResponse]]] GetRules(System.String, System.Nullable`1[System.Boolean], System.String, Int32, Int32) on controller site.diogocosta.dev.Controllers.AntiSpamController (site.diogocosta.dev).
2025-07-10 19:39:31.677 -03:00 [INF] Executed DbCommand (270ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM public.antispam_rules AS a
2025-07-10 19:39:31.947 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__p_1='50', @__p_0='0'], CommandType='"Text"', CommandTimeout='30']
SELECT a.id AS "Id", a.rule_type AS "RuleType", a.rule_value AS "RuleValue", a.description AS "Description", a.severity AS "Severity", a.is_active AS "IsActive", a.is_regex AS "IsRegex", a.created_at AS "CreatedAt", a.updated_at AS "UpdatedAt", a.created_by AS "CreatedBy", a.detection_count AS "DetectionCount", a.last_detection AS "LastDetection"
FROM public.antispam_rules AS a
ORDER BY a.created_at DESC
LIMIT @__p_1 OFFSET @__p_0
2025-07-10 19:39:31.950 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[site.diogocosta.dev.Models.AntiSpamRuleResponse, site.diogocosta.dev, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-10 19:39:31.951 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev) in 600.3161ms
2025-07-10 19:39:31.952 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev)'
2025-07-10 19:39:31.953 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/antispam - 200 null application/json; charset=utf-8 612.351ms
2025-07-10 19:42:40.394 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/leads - application/json 145
2025-07-10 19:42:40.398 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/leads - 404 0 null 4.2063ms
2025-07-10 19:42:40.402 -03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:5000/api/leads, Response status code: 404
2025-07-10 19:42:45.500 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/antispam - null null
2025-07-10 19:42:45.503 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev)'
2025-07-10 19:42:45.504 -03:00 [INF] Route matched with {action = "GetRules", controller = "AntiSpam"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[site.diogocosta.dev.Models.AntiSpamRuleResponse]]] GetRules(System.String, System.Nullable`1[System.Boolean], System.String, Int32, Int32) on controller site.diogocosta.dev.Controllers.AntiSpamController (site.diogocosta.dev).
2025-07-10 19:42:45.778 -03:00 [INF] Executed DbCommand (271ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM public.antispam_rules AS a
2025-07-10 19:42:46.049 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@__p_1='50', @__p_0='0'], CommandType='"Text"', CommandTimeout='30']
SELECT a.id AS "Id", a.rule_type AS "RuleType", a.rule_value AS "RuleValue", a.description AS "Description", a.severity AS "Severity", a.is_active AS "IsActive", a.is_regex AS "IsRegex", a.created_at AS "CreatedAt", a.updated_at AS "UpdatedAt", a.created_by AS "CreatedBy", a.detection_count AS "DetectionCount", a.last_detection AS "LastDetection"
FROM public.antispam_rules AS a
ORDER BY a.created_at DESC
LIMIT @__p_1 OFFSET @__p_0
2025-07-10 19:42:46.051 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[site.diogocosta.dev.Models.AntiSpamRuleResponse, site.diogocosta.dev, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-10 19:42:46.053 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev) in 547.3252ms
2025-07-10 19:42:46.054 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev)'
2025-07-10 19:42:46.055 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/antispam - 200 null application/json; charset=utf-8 554.8271ms
2025-07-10 19:43:29.622 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@__recentCutoff_0='2025-07-10T22:13:27.7361029Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.dados, l.descricao, l.ip_address, l.lead_id, l.tipo, l.user_agent
FROM leads_system.lead_interactions AS l
WHERE l.created_at >= @__recentCutoff_0
2025-07-10 19:44:34.177 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 94
2025-07-10 19:44:34.182 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:44:34.191 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:44:34.212 -03:00 [WRN] Padrão de spam russo detectado no email: bot1@tempmail.ru - Padrão: @tempmail
2025-07-10 19:44:34.213 -03:00 [WRN] 🤖 Email/Nome suspeito detectado - Email: bot1@tempmail.ru, Nome: Bot Test 1, IP: 192.168.100.50
2025-07-10 19:44:34.216 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:44:34.219 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 26.0989ms
2025-07-10 19:44:34.221 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:44:34.222 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 44.3272ms
2025-07-10 19:44:34.224 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:44:34.226 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:44:34.228 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:44:34.234 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'NULL'
2025-07-10 19:44:34.235 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'NULL'
2025-07-10 19:44:34.261 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:44:34.341 -03:00 [INF] Executed ViewResult - view Obrigado executed in 81.9055ms.
2025-07-10 19:44:34.343 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 113.1834ms
2025-07-10 19:44:34.344 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:44:34.345 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 121.287ms
2025-07-10 19:44:34.725 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 94
2025-07-10 19:44:34.729 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:44:34.729 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:44:34.740 -03:00 [WRN] Padrão de spam russo detectado no email: bot2@tempmail.ru - Padrão: @tempmail
2025-07-10 19:44:34.742 -03:00 [WRN] 🤖 Email/Nome suspeito detectado - Email: bot2@tempmail.ru, Nome: Bot Test 2, IP: 192.168.100.50
2025-07-10 19:44:34.743 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:44:34.745 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 13.7824ms
2025-07-10 19:44:34.746 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:44:34.747 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 22.0189ms
2025-07-10 19:44:34.750 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:44:34.753 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:44:34.754 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:44:34.756 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'NULL'
2025-07-10 19:44:34.757 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'NULL'
2025-07-10 19:44:34.758 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:44:34.762 -03:00 [INF] Executed ViewResult - view Obrigado executed in 3.7641ms.
2025-07-10 19:44:34.763 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 7.5722ms
2025-07-10 19:44:34.764 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:44:34.765 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 15.1133ms
2025-07-10 19:44:35.129 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 94
2025-07-10 19:44:35.132 -03:00 [WRN] 🚫 Rate limit excedido para IP: 192.168.100.50 na rota: /Desbloqueio/Cadastrar
2025-07-10 19:44:35.134 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 429 null null 4.19ms
2025-07-10 19:44:35.456 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 94
2025-07-10 19:44:35.458 -03:00 [WRN] 🚫 Rate limit excedido para IP: 192.168.100.50 na rota: /Desbloqueio/Cadastrar
2025-07-10 19:44:35.459 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 429 null null 3.192ms
2025-07-10 19:44:35.784 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 94
2025-07-10 19:44:35.786 -03:00 [WRN] 🚫 Rate limit excedido para IP: 192.168.100.50 na rota: /Desbloqueio/Cadastrar
2025-07-10 19:44:35.787 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 429 null null 3.2342ms
2025-07-10 19:44:36.110 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 94
2025-07-10 19:44:36.112 -03:00 [WRN] 🚫 Rate limit excedido para IP: 192.168.100.50 na rota: /Desbloqueio/Cadastrar
2025-07-10 19:44:36.113 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 429 null null 3.0593ms
2025-07-10 19:44:36.436 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 94
2025-07-10 19:44:36.439 -03:00 [WRN] 🚫 Rate limit excedido para IP: 192.168.100.50 na rota: /Desbloqueio/Cadastrar
2025-07-10 19:44:36.440 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 429 null null 3.6642ms
2025-07-10 19:44:36.748 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 94
2025-07-10 19:44:36.750 -03:00 [WRN] 🚫 Rate limit excedido para IP: 192.168.100.50 na rota: /Desbloqueio/Cadastrar
2025-07-10 19:44:36.750 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 429 null null 2.6963ms
2025-07-10 19:44:37.060 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 94
2025-07-10 19:44:37.062 -03:00 [WRN] 🚫 Rate limit excedido para IP: 192.168.100.50 na rota: /Desbloqueio/Cadastrar
2025-07-10 19:44:37.063 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 429 null null 2.7491ms
2025-07-10 19:44:37.372 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 97
2025-07-10 19:44:37.374 -03:00 [WRN] 🚫 Rate limit excedido para IP: 192.168.100.50 na rota: /Desbloqueio/Cadastrar
2025-07-10 19:44:37.374 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 429 null null 2.7428ms
2025-07-10 19:44:37.683 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 97
2025-07-10 19:44:37.685 -03:00 [WRN] 🚫 Rate limit excedido para IP: 192.168.100.50 na rota: /Desbloqueio/Cadastrar
2025-07-10 19:44:37.686 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 429 null null 3.5534ms
2025-07-10 19:44:37.997 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 97
2025-07-10 19:44:37.999 -03:00 [WRN] 🚫 Rate limit excedido para IP: 192.168.100.50 na rota: /Desbloqueio/Cadastrar
2025-07-10 19:44:38.000 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 429 null null 2.9998ms
2025-07-10 19:44:38.309 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 89
2025-07-10 19:44:38.311 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:44:38.312 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:44:38.319 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test1@gmail.com, Nome: User 1
2025-07-10 19:44:38.320 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.61, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:44:38.321 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:44:38.322 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test1@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:44:38.647 -03:00 [INF] Executed DbCommand (270ms) [Parameters=[@__ToLower_0='test1@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:44:38.949 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:44:39.326 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@p0='2025-07-10T22:44:39.0166930Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test1@gmail.com' (Nullable = false), @p3='192.168.100.61' (DbType = Object), @p4='User 1' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:44:39.0167173Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:44:39.621 -03:00 [INF] Executed DbCommand (270ms) [Parameters=[@p0='2025-07-10T22:44:39.3422961Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='19', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:44:39.625 -03:00 [INF] Novo lead criado: test1@gmail.com para manual-primeira-virada (ID: 19)
2025-07-10 19:44:39.626 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test1@gmail.com (ID: 19)
2025-07-10 19:44:39.628 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test1@gmail.com
2025-07-10 19:44:39.630 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:44:39.631 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:44:39.898 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:44:40.528 -03:00 [INF] Received HTTP response headers after 894.8235ms - 200
2025-07-10 19:44:40.529 -03:00 [INF] End processing HTTP request after 899.7091ms - 200
2025-07-10 19:44:40.530 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test1@gmail.com
2025-07-10 19:44:47.724 -03:00 [INF] ✅ Email enviado com sucesso para test1@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:44:47.725 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test1@gmail.com'
2025-07-10 19:44:47.726 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 1'
2025-07-10 19:44:47.726 -03:00 [INF] Usuário User 1 (test1@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:44:47.728 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:44:47.729 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 9415.4932ms
2025-07-10 19:44:47.730 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:44:47.730 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 9420.9063ms
2025-07-10 19:44:47.732 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:44:47.733 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:44:47.734 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:44:47.737 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test1@gmail.com'
2025-07-10 19:44:47.737 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 1'
2025-07-10 19:44:47.740 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:44:47.742 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.8037ms.
2025-07-10 19:44:47.742 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 6.3585ms
2025-07-10 19:44:47.743 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:44:47.744 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 12.0261ms
2025-07-10 19:44:47.769 -03:00 [INF] ✅ Email enviado com sucesso para test1@gmail.com - Assunto: 🔥 User 1, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:44:47.773 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 19
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.CheckDisposed()
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.Microsoft.EntityFrameworkCore.Internal.IDbContextDependencies.get_StateManager()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.EntryWithoutDetectChanges(TEntity entity)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.Add(TEntity entity)
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 249
2025-07-10 19:44:48.000 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 89
2025-07-10 19:44:48.003 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:44:48.004 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:44:48.006 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test2@gmail.com, Nome: User 2
2025-07-10 19:44:48.007 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.62, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:44:48.008 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:44:48.009 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test2@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:44:48.276 -03:00 [INF] Executed DbCommand (266ms) [Parameters=[@__ToLower_0='test2@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:44:48.544 -03:00 [INF] Executed DbCommand (266ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:44:48.815 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@p0='2025-07-10T22:44:48.5468881Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test2@gmail.com' (Nullable = false), @p3='192.168.100.62' (DbType = Object), @p4='User 2' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:44:48.5468881Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:44:49.087 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@p0='2025-07-10T22:44:48.8172414Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='20', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:44:49.089 -03:00 [INF] Novo lead criado: test2@gmail.com para manual-primeira-virada (ID: 20)
2025-07-10 19:44:49.090 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test2@gmail.com (ID: 20)
2025-07-10 19:44:49.091 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test2@gmail.com
2025-07-10 19:44:49.092 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:44:49.093 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:44:49.351 -03:00 [INF] Received HTTP response headers after 257.3716ms - 200
2025-07-10 19:44:49.353 -03:00 [INF] End processing HTTP request after 260.9078ms - 200
2025-07-10 19:44:49.354 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test2@gmail.com
2025-07-10 19:44:49.357 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:44:53.223 -03:00 [INF] ✅ Email enviado com sucesso para test2@gmail.com - Assunto: 🔥 User 2, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:44:53.311 -03:00 [INF] ✅ Email enviado com sucesso para test2@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:44:53.313 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test2@gmail.com'
2025-07-10 19:44:53.314 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 2'
2025-07-10 19:44:53.314 -03:00 [INF] Usuário User 2 (test2@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:44:53.316 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:44:53.317 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 5311.7841ms
2025-07-10 19:44:53.319 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:44:53.327 -03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 User 2, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='test2@gmail.com' (Nullable = false), @p5='2025-07-10T22:44:53.2251775Z' (DbType = DateTime), @p6=NULL, @p7='20' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:44:53.332 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:00000011": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:44:53.339 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:44:53.347 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 5346.408ms
2025-07-10 19:44:53.356 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:44:53.356 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 20
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.CheckDisposed()
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 250
2025-07-10 19:44:53.357 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:44:53.360 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:44:53.362 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test2@gmail.com'
2025-07-10 19:44:53.362 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 2'
2025-07-10 19:44:53.363 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:44:53.364 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.5056ms.
2025-07-10 19:44:53.365 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.9415ms
2025-07-10 19:44:53.366 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:44:53.367 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 10.7261ms
2025-07-10 19:44:53.625 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 89
2025-07-10 19:44:53.626 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:44:53.627 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:44:53.629 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test3@gmail.com, Nome: User 3
2025-07-10 19:44:53.629 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.63, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:44:53.630 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:44:53.631 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test3@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:44:55.495 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__ToLower_0='test3@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:44:55.761 -03:00 [INF] Executed DbCommand (264ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:44:56.031 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@p0='2025-07-10T22:44:55.7639767Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test3@gmail.com' (Nullable = false), @p3='192.168.100.63' (DbType = Object), @p4='User 3' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:44:55.7639768Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:44:56.302 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@p0='2025-07-10T22:44:56.0329874Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='21', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:44:56.304 -03:00 [INF] Novo lead criado: test3@gmail.com para manual-primeira-virada (ID: 21)
2025-07-10 19:44:56.305 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test3@gmail.com (ID: 21)
2025-07-10 19:44:56.307 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test3@gmail.com
2025-07-10 19:44:56.307 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:44:56.308 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:44:56.567 -03:00 [INF] Received HTTP response headers after 257.5042ms - 200
2025-07-10 19:44:56.568 -03:00 [INF] End processing HTTP request after 261.1333ms - 200
2025-07-10 19:44:56.570 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test3@gmail.com
2025-07-10 19:44:56.572 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:45:00.644 -03:00 [INF] ✅ Email enviado com sucesso para test3@gmail.com - Assunto: 🔥 User 3, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:45:00.667 -03:00 [INF] ✅ Email enviado com sucesso para test3@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:45:00.669 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test3@gmail.com'
2025-07-10 19:45:00.670 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 3'
2025-07-10 19:45:00.670 -03:00 [INF] Usuário User 3 (test3@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:45:00.671 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:45:00.672 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 7044.1624ms
2025-07-10 19:45:00.673 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:00.674 -03:00 [ERR] Failed executing DbCommand (27ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 User 3, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='test3@gmail.com' (Nullable = false), @p5='2025-07-10T22:45:00.6459648Z' (DbType = DateTime), @p6=NULL, @p7='21' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:45:00.674 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:00000013": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:45:00.678 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:45:00.684 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 7059.8047ms
2025-07-10 19:45:00.694 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 21
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 250
2025-07-10 19:45:00.694 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:45:00.697 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:00.698 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:00.699 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test3@gmail.com'
2025-07-10 19:45:00.700 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 3'
2025-07-10 19:45:00.700 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:45:00.702 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.7898ms.
2025-07-10 19:45:00.703 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 4.3864ms
2025-07-10 19:45:00.705 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:00.705 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 11.225ms
2025-07-10 19:45:00.972 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 89
2025-07-10 19:45:00.974 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:00.975 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:00.977 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test4@gmail.com, Nome: User 4
2025-07-10 19:45:00.978 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.64, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:45:00.978 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:45:00.979 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test4@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:45:02.864 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@__ToLower_0='test4@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:45:03.132 -03:00 [INF] Executed DbCommand (266ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:45:03.406 -03:00 [INF] Executed DbCommand (271ms) [Parameters=[@p0='2025-07-10T22:45:03.1345843Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test4@gmail.com' (Nullable = false), @p3='192.168.100.64' (DbType = Object), @p4='User 4' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:45:03.1345843Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:45:03.678 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@p0='2025-07-10T22:45:03.4085668Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='22', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:45:03.680 -03:00 [INF] Novo lead criado: test4@gmail.com para manual-primeira-virada (ID: 22)
2025-07-10 19:45:03.680 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test4@gmail.com (ID: 22)
2025-07-10 19:45:03.681 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test4@gmail.com
2025-07-10 19:45:03.682 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:03.682 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:03.938 -03:00 [INF] Received HTTP response headers after 254.3667ms - 200
2025-07-10 19:45:03.939 -03:00 [INF] End processing HTTP request after 256.9115ms - 200
2025-07-10 19:45:03.940 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test4@gmail.com
2025-07-10 19:45:03.944 -03:00 [INF] Executed DbCommand (263ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:45:07.918 -03:00 [INF] ✅ Email enviado com sucesso para test4@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:45:07.920 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test4@gmail.com'
2025-07-10 19:45:07.920 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 4'
2025-07-10 19:45:07.921 -03:00 [INF] Usuário User 4 (test4@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:45:07.922 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:45:07.923 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 6946.469ms
2025-07-10 19:45:07.923 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:07.924 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 6952.0979ms
2025-07-10 19:45:07.926 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:45:07.927 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:07.928 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:07.929 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test4@gmail.com'
2025-07-10 19:45:07.930 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 4'
2025-07-10 19:45:07.930 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:45:07.931 -03:00 [INF] Executed ViewResult - view Obrigado executed in 0.9697ms.
2025-07-10 19:45:07.932 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.4213ms
2025-07-10 19:45:07.933 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:07.934 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 7.8939ms
2025-07-10 19:45:08.033 -03:00 [INF] ✅ Email enviado com sucesso para test4@gmail.com - Assunto: 🔥 User 4, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:45:08.034 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 22
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.Microsoft.EntityFrameworkCore.Internal.IDbContextDependencies.get_StateManager()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.EntryWithoutDetectChanges(TEntity entity)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.Add(TEntity entity)
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 249
2025-07-10 19:45:08.188 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 89
2025-07-10 19:45:08.190 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:08.191 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:08.193 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test5@gmail.com, Nome: User 5
2025-07-10 19:45:08.194 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.65, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:45:08.195 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:45:08.196 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test5@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:45:08.463 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[@__ToLower_0='test5@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:45:08.730 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:45:09.002 -03:00 [INF] Executed DbCommand (270ms) [Parameters=[@p0='2025-07-10T22:45:08.7327030Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test5@gmail.com' (Nullable = false), @p3='192.168.100.65' (DbType = Object), @p4='User 5' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:45:08.7327031Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:45:09.273 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@p0='2025-07-10T22:45:09.0043808Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='23', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:45:09.275 -03:00 [INF] Novo lead criado: test5@gmail.com para manual-primeira-virada (ID: 23)
2025-07-10 19:45:09.275 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test5@gmail.com (ID: 23)
2025-07-10 19:45:09.276 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test5@gmail.com
2025-07-10 19:45:09.277 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:09.278 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:09.531 -03:00 [INF] Received HTTP response headers after 252.1163ms - 200
2025-07-10 19:45:09.532 -03:00 [INF] End processing HTTP request after 254.95ms - 200
2025-07-10 19:45:09.533 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test5@gmail.com
2025-07-10 19:45:09.544 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:45:13.445 -03:00 [INF] ✅ Email enviado com sucesso para test5@gmail.com - Assunto: 🔥 User 5, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:45:13.715 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 User 5, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='test5@gmail.com' (Nullable = false), @p5='2025-07-10T22:45:13.4470830Z' (DbType = DateTime), @p6=NULL, @p7='23' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:45:13.721 -03:00 [INF] ✅ Email enviado com sucesso para test5@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:45:13.722 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test5@gmail.com'
2025-07-10 19:45:13.723 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 5'
2025-07-10 19:45:13.723 -03:00 [INF] Usuário User 5 (test5@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:45:13.724 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:45:13.725 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 5532.4606ms
2025-07-10 19:45:13.725 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:13.727 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:00000017": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:45:13.727 -03:00 [ERR] Failed executing DbCommand (6ms) [Parameters=[@p0='2025-07-10T22:45:13.7195684Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Email enviado: boas-vindas', @p3=NULL (DbType = Object), @p4='23', @p5='email_sent' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:45:13.734 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 5545.951ms
2025-07-10 19:45:13.736 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:45:13.737 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:45:13.747 -03:00 [ERR] Erro ao registrar interação para lead 23: email_sent
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.RegistrarInteracaoAsync(Int32 leadId, String tipo, String descricao, Object dados) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 155
2025-07-10 19:45:13.747 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:13.749 -03:00 [INF] Email de boas-vindas enviado para test5@gmail.com
2025-07-10 19:45:13.749 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:13.752 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test5@gmail.com'
2025-07-10 19:45:13.753 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 5'
2025-07-10 19:45:13.753 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:45:13.754 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.006ms.
2025-07-10 19:45:13.755 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.8996ms
2025-07-10 19:45:13.756 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:13.757 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 20.4292ms
2025-07-10 19:45:14.009 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 89
2025-07-10 19:45:14.011 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:14.011 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:14.014 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test6@gmail.com, Nome: User 6
2025-07-10 19:45:14.014 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.66, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:45:14.015 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:45:14.016 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test6@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:45:15.887 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@__ToLower_0='test6@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:45:16.154 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:45:16.426 -03:00 [INF] Executed DbCommand (270ms) [Parameters=[@p0='2025-07-10T22:45:16.1562786Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test6@gmail.com' (Nullable = false), @p3='192.168.100.66' (DbType = Object), @p4='User 6' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:45:16.1562787Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:45:16.698 -03:00 [INF] Executed DbCommand (270ms) [Parameters=[@p0='2025-07-10T22:45:16.4280508Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='24', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:45:16.700 -03:00 [INF] Novo lead criado: test6@gmail.com para manual-primeira-virada (ID: 24)
2025-07-10 19:45:16.700 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test6@gmail.com (ID: 24)
2025-07-10 19:45:16.702 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test6@gmail.com
2025-07-10 19:45:16.703 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:16.704 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:16.963 -03:00 [INF] Received HTTP response headers after 258.882ms - 200
2025-07-10 19:45:16.964 -03:00 [INF] End processing HTTP request after 261.6362ms - 200
2025-07-10 19:45:16.965 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test6@gmail.com
2025-07-10 19:45:16.969 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:45:20.891 -03:00 [INF] ✅ Email enviado com sucesso para test6@gmail.com - Assunto: 🔥 User 6, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:45:21.057 -03:00 [INF] ✅ Email enviado com sucesso para test6@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:45:21.058 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test6@gmail.com'
2025-07-10 19:45:21.059 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 6'
2025-07-10 19:45:21.060 -03:00 [INF] Usuário User 6 (test6@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:45:21.061 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:45:21.061 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 7048.6225ms
2025-07-10 19:45:21.062 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:21.063 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:00000019": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:45:21.063 -03:00 [ERR] Failed executing DbCommand (169ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 User 6, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='test6@gmail.com' (Nullable = false), @p5='2025-07-10T22:45:20.8932237Z' (DbType = DateTime), @p6=NULL, @p7='24' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:45:21.071 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 7061.8313ms
2025-07-10 19:45:21.082 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:45:21.083 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:45:21.094 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:21.094 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 24
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 250
2025-07-10 19:45:21.094 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:21.098 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test6@gmail.com'
2025-07-10 19:45:21.098 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 6'
2025-07-10 19:45:21.099 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:45:21.100 -03:00 [INF] Executed ViewResult - view Obrigado executed in 0.956ms.
2025-07-10 19:45:21.101 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.2899ms
2025-07-10 19:45:21.102 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:21.103 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 19.9948ms
2025-07-10 19:45:21.350 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 89
2025-07-10 19:45:21.352 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:21.353 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:21.355 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test7@gmail.com, Nome: User 7
2025-07-10 19:45:21.355 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.67, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:45:21.356 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:45:21.357 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test7@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:45:23.229 -03:00 [INF] Executed DbCommand (266ms) [Parameters=[@__ToLower_0='test7@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:45:23.500 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:45:23.776 -03:00 [INF] Executed DbCommand (270ms) [Parameters=[@p0='2025-07-10T22:45:23.5056824Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test7@gmail.com' (Nullable = false), @p3='192.168.100.67' (DbType = Object), @p4='User 7' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:45:23.5056825Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:45:24.048 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@p0='2025-07-10T22:45:23.7784093Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='25', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:45:24.049 -03:00 [INF] Novo lead criado: test7@gmail.com para manual-primeira-virada (ID: 25)
2025-07-10 19:45:24.050 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test7@gmail.com (ID: 25)
2025-07-10 19:45:24.052 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test7@gmail.com
2025-07-10 19:45:24.052 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:24.053 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:24.311 -03:00 [INF] Received HTTP response headers after 256.6919ms - 200
2025-07-10 19:45:24.311 -03:00 [INF] End processing HTTP request after 259.03ms - 200
2025-07-10 19:45:24.312 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test7@gmail.com
2025-07-10 19:45:24.318 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:45:28.237 -03:00 [INF] ✅ Email enviado com sucesso para test7@gmail.com - Assunto: 🔥 User 7, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:45:28.438 -03:00 [INF] ✅ Email enviado com sucesso para test7@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:45:28.439 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test7@gmail.com'
2025-07-10 19:45:28.440 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 7'
2025-07-10 19:45:28.440 -03:00 [INF] Usuário User 7 (test7@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:45:28.441 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:45:28.442 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 7087.7372ms
2025-07-10 19:45:28.443 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:28.444 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:0000001B": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:45:28.444 -03:00 [ERR] Failed executing DbCommand (205ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 User 7, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='test7@gmail.com' (Nullable = false), @p5='2025-07-10T22:45:28.2383361Z' (DbType = DateTime), @p6=NULL, @p7='25' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:45:28.451 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 7101.3002ms
2025-07-10 19:45:28.453 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:45:28.454 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:45:28.465 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 25
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 250
2025-07-10 19:45:28.465 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:28.468 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:28.470 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test7@gmail.com'
2025-07-10 19:45:28.471 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 7'
2025-07-10 19:45:28.471 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:45:28.472 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.0649ms.
2025-07-10 19:45:28.473 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.535ms
2025-07-10 19:45:28.474 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:28.475 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 20.4786ms
2025-07-10 19:45:28.730 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 89
2025-07-10 19:45:28.731 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:28.732 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:28.734 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test8@gmail.com, Nome: User 8
2025-07-10 19:45:28.735 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.68, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:45:28.736 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:45:28.737 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test8@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:45:30.607 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@__ToLower_0='test8@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:45:30.874 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:45:31.144 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@p0='2025-07-10T22:45:30.8761780Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test8@gmail.com' (Nullable = false), @p3='192.168.100.68' (DbType = Object), @p4='User 8' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:45:30.8761781Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:45:31.413 -03:00 [INF] Executed DbCommand (266ms) [Parameters=[@p0='2025-07-10T22:45:31.1466046Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='26', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:45:31.415 -03:00 [INF] Novo lead criado: test8@gmail.com para manual-primeira-virada (ID: 26)
2025-07-10 19:45:31.416 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test8@gmail.com (ID: 26)
2025-07-10 19:45:31.417 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test8@gmail.com
2025-07-10 19:45:31.418 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:31.419 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:31.675 -03:00 [INF] Received HTTP response headers after 255.1548ms - 200
2025-07-10 19:45:31.676 -03:00 [INF] End processing HTTP request after 258.1858ms - 200
2025-07-10 19:45:31.677 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test8@gmail.com
2025-07-10 19:45:31.682 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:45:35.532 -03:00 [INF] ✅ Email enviado com sucesso para test8@gmail.com - Assunto: 🔥 User 8, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:45:35.638 -03:00 [INF] ✅ Email enviado com sucesso para test8@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:45:35.640 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test8@gmail.com'
2025-07-10 19:45:35.641 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 8'
2025-07-10 19:45:35.642 -03:00 [INF] Usuário User 8 (test8@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:45:35.643 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:45:35.644 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 6910.6702ms
2025-07-10 19:45:35.645 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:35.646 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:0000001D": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:45:35.646 -03:00 [ERR] Failed executing DbCommand (111ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 User 8, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='test8@gmail.com' (Nullable = false), @p5='2025-07-10T22:45:35.5338037Z' (DbType = DateTime), @p6=NULL, @p7='26' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:45:35.654 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 6924.2052ms
2025-07-10 19:45:35.656 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:45:35.657 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:45:35.668 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 26
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 250
2025-07-10 19:45:35.669 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:35.672 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:35.674 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test8@gmail.com'
2025-07-10 19:45:35.675 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 8'
2025-07-10 19:45:35.675 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:45:35.677 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.2185ms.
2025-07-10 19:45:35.677 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.7257ms
2025-07-10 19:45:35.678 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:35.679 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 22.4081ms
2025-07-10 19:45:35.929 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 89
2025-07-10 19:45:35.930 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:35.931 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:35.933 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test9@gmail.com, Nome: User 9
2025-07-10 19:45:35.933 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.69, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:45:35.935 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:45:35.936 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test9@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:45:37.811 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__ToLower_0='test9@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:45:38.077 -03:00 [INF] Executed DbCommand (264ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:45:38.345 -03:00 [INF] Executed DbCommand (266ms) [Parameters=[@p0='2025-07-10T22:45:38.0798670Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test9@gmail.com' (Nullable = false), @p3='192.168.100.69' (DbType = Object), @p4='User 9' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:45:38.0798670Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:45:38.613 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[@p0='2025-07-10T22:45:38.3478642Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='27', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:45:38.615 -03:00 [INF] Novo lead criado: test9@gmail.com para manual-primeira-virada (ID: 27)
2025-07-10 19:45:38.615 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test9@gmail.com (ID: 27)
2025-07-10 19:45:38.616 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test9@gmail.com
2025-07-10 19:45:38.617 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:38.618 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:38.875 -03:00 [INF] Received HTTP response headers after 255.3422ms - 200
2025-07-10 19:45:38.875 -03:00 [INF] End processing HTTP request after 258.6377ms - 200
2025-07-10 19:45:38.876 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test9@gmail.com
2025-07-10 19:45:38.884 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:45:43.323 -03:00 [INF] ✅ Email enviado com sucesso para test9@gmail.com - Assunto: 🔥 User 9, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:45:43.527 -03:00 [INF] ✅ Email enviado com sucesso para test9@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:45:43.529 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test9@gmail.com'
2025-07-10 19:45:43.529 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 9'
2025-07-10 19:45:43.530 -03:00 [INF] Usuário User 9 (test9@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:45:43.530 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:45:43.531 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 7598.9998ms
2025-07-10 19:45:43.532 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:43.533 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:0000001F": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:45:43.533 -03:00 [ERR] Failed executing DbCommand (207ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 User 9, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='test9@gmail.com' (Nullable = false), @p5='2025-07-10T22:45:43.3251500Z' (DbType = DateTime), @p6=NULL, @p7='27' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:45:43.540 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 7611.6892ms
2025-07-10 19:45:43.542 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:45:43.543 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:45:43.553 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 27
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 250
2025-07-10 19:45:43.553 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:43.556 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:43.557 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test9@gmail.com'
2025-07-10 19:45:43.558 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 9'
2025-07-10 19:45:43.559 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:45:43.560 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.0213ms.
2025-07-10 19:45:43.561 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 4.1947ms
2025-07-10 19:45:43.562 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:43.563 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 20.4048ms
2025-07-10 19:45:43.808 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 92
2025-07-10 19:45:43.810 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:43.810 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:43.812 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test10@gmail.com, Nome: User 10
2025-07-10 19:45:43.813 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.70, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:45:43.813 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:45:43.814 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test10@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:45:45.689 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@__ToLower_0='test10@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:45:45.958 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:45:46.229 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@p0='2025-07-10T22:45:45.9604322Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test10@gmail.com' (Nullable = false), @p3='192.168.100.70' (DbType = Object), @p4='User 10' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:45:45.9604322Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:45:46.507 -03:00 [INF] Executed DbCommand (276ms) [Parameters=[@p0='2025-07-10T22:45:46.2314319Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='28', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:45:46.509 -03:00 [INF] Novo lead criado: test10@gmail.com para manual-primeira-virada (ID: 28)
2025-07-10 19:45:46.510 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test10@gmail.com (ID: 28)
2025-07-10 19:45:46.511 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test10@gmail.com
2025-07-10 19:45:46.511 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:46.512 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:46.765 -03:00 [INF] Received HTTP response headers after 252.4791ms - 200
2025-07-10 19:45:46.766 -03:00 [INF] End processing HTTP request after 254.6916ms - 200
2025-07-10 19:45:46.767 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test10@gmail.com
2025-07-10 19:45:46.779 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:45:51.450 -03:00 [INF] ✅ Email enviado com sucesso para test10@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:45:51.452 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test10@gmail.com'
2025-07-10 19:45:51.453 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 10'
2025-07-10 19:45:51.453 -03:00 [INF] Usuário User 10 (test10@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:45:51.454 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:45:51.455 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 7643.526ms
2025-07-10 19:45:51.456 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:51.456 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 7648.2214ms
2025-07-10 19:45:51.458 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:45:51.459 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:51.460 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:51.462 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test10@gmail.com'
2025-07-10 19:45:51.462 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 10'
2025-07-10 19:45:51.463 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:45:51.464 -03:00 [INF] Executed ViewResult - view Obrigado executed in 0.9715ms.
2025-07-10 19:45:51.465 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.9267ms
2025-07-10 19:45:51.466 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:51.467 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 8.6605ms
2025-07-10 19:45:51.481 -03:00 [INF] ✅ Email enviado com sucesso para test10@gmail.com - Assunto: 🔥 User 10, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:45:51.482 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 28
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.Microsoft.EntityFrameworkCore.Internal.IDbContextDependencies.get_StateManager()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.EntryWithoutDetectChanges(TEntity entity)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.Add(TEntity entity)
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 249
2025-07-10 19:45:51.714 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 92
2025-07-10 19:45:51.715 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:51.716 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:51.718 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test11@gmail.com, Nome: User 11
2025-07-10 19:45:51.719 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.71, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:45:51.720 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:45:51.721 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test11@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:45:51.986 -03:00 [INF] Executed DbCommand (264ms) [Parameters=[@__ToLower_0='test11@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:45:52.257 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:45:52.529 -03:00 [INF] Executed DbCommand (270ms) [Parameters=[@p0='2025-07-10T22:45:52.2592340Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test11@gmail.com' (Nullable = false), @p3='192.168.100.71' (DbType = Object), @p4='User 11' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:45:52.2592340Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:45:52.801 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@p0='2025-07-10T22:45:52.5334444Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='29', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:45:52.803 -03:00 [INF] Novo lead criado: test11@gmail.com para manual-primeira-virada (ID: 29)
2025-07-10 19:45:52.804 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test11@gmail.com (ID: 29)
2025-07-10 19:45:52.805 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test11@gmail.com
2025-07-10 19:45:52.805 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:52.806 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:53.058 -03:00 [INF] Received HTTP response headers after 251.3445ms - 200
2025-07-10 19:45:53.060 -03:00 [INF] End processing HTTP request after 254.2224ms - 200
2025-07-10 19:45:53.061 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test11@gmail.com
2025-07-10 19:45:53.069 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:45:57.098 -03:00 [INF] ✅ Email enviado com sucesso para test11@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:45:57.099 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test11@gmail.com'
2025-07-10 19:45:57.100 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 11'
2025-07-10 19:45:57.100 -03:00 [INF] Usuário User 11 (test11@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:45:57.102 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:45:57.103 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 5385.5207ms
2025-07-10 19:45:57.104 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:57.104 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 5390.4282ms
2025-07-10 19:45:57.106 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:45:57.107 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:57.108 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:57.110 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test11@gmail.com'
2025-07-10 19:45:57.110 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 11'
2025-07-10 19:45:57.111 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:45:57.112 -03:00 [INF] Executed ViewResult - view Obrigado executed in 0.8605ms.
2025-07-10 19:45:57.112 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.276ms
2025-07-10 19:45:57.113 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:45:57.114 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 7.9607ms
2025-07-10 19:45:57.125 -03:00 [INF] ✅ Email enviado com sucesso para test11@gmail.com - Assunto: 🔥 User 11, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:45:57.126 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 29
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.Microsoft.EntityFrameworkCore.Internal.IDbContextDependencies.get_StateManager()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.EntryWithoutDetectChanges(TEntity entity)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.Add(TEntity entity)
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 249
2025-07-10 19:45:57.373 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 92
2025-07-10 19:45:57.374 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:45:57.375 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:45:57.377 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test12@gmail.com, Nome: User 12
2025-07-10 19:45:57.378 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.72, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:45:57.378 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:45:57.379 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test12@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:45:57.647 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__ToLower_0='test12@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:45:57.912 -03:00 [INF] Executed DbCommand (263ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:45:58.178 -03:00 [INF] Executed DbCommand (264ms) [Parameters=[@p0='2025-07-10T22:45:57.9138459Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test12@gmail.com' (Nullable = false), @p3='192.168.100.72' (DbType = Object), @p4='User 12' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:45:57.9138459Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:45:58.449 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@p0='2025-07-10T22:45:58.1802772Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='30', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:45:58.451 -03:00 [INF] Novo lead criado: test12@gmail.com para manual-primeira-virada (ID: 30)
2025-07-10 19:45:58.453 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test12@gmail.com (ID: 30)
2025-07-10 19:45:58.453 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test12@gmail.com
2025-07-10 19:45:58.454 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:58.455 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:45:58.704 -03:00 [INF] Received HTTP response headers after 248.4758ms - 200
2025-07-10 19:45:58.705 -03:00 [INF] End processing HTTP request after 251.0392ms - 200
2025-07-10 19:45:58.706 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test12@gmail.com
2025-07-10 19:45:58.720 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:46:02.559 -03:00 [INF] ✅ Email enviado com sucesso para test12@gmail.com - Assunto: 🔥 User 12, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:46:02.713 -03:00 [INF] ✅ Email enviado com sucesso para test12@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:46:02.714 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test12@gmail.com'
2025-07-10 19:46:02.715 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 12'
2025-07-10 19:46:02.716 -03:00 [INF] Usuário User 12 (test12@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:46:02.716 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:46:02.717 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 5340.9145ms
2025-07-10 19:46:02.718 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:02.720 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:00000025": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:46:02.720 -03:00 [ERR] Failed executing DbCommand (159ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 User 12, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='test12@gmail.com' (Nullable = false), @p5='2025-07-10T22:46:02.5607077Z' (DbType = DateTime), @p6=NULL, @p7='30' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:46:02.727 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 5354.0584ms
2025-07-10 19:46:02.728 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:46:02.729 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:46:02.739 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 30
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 250
2025-07-10 19:46:02.740 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:02.742 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:02.744 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test12@gmail.com'
2025-07-10 19:46:02.744 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 12'
2025-07-10 19:46:02.745 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:46:02.746 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.0395ms.
2025-07-10 19:46:02.747 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.701ms
2025-07-10 19:46:02.748 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:02.748 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 19.4239ms
2025-07-10 19:46:03.003 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 92
2025-07-10 19:46:03.005 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:03.006 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:03.008 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test13@gmail.com, Nome: User 13
2025-07-10 19:46:03.009 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.73, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:46:03.010 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:46:03.010 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test13@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:46:04.886 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__ToLower_0='test13@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:46:05.152 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:46:05.424 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@p0='2025-07-10T22:46:05.1543656Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test13@gmail.com' (Nullable = false), @p3='192.168.100.73' (DbType = Object), @p4='User 13' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:46:05.1543657Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:46:05.693 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@p0='2025-07-10T22:46:05.4257868Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='31', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:46:05.695 -03:00 [INF] Novo lead criado: test13@gmail.com para manual-primeira-virada (ID: 31)
2025-07-10 19:46:05.696 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test13@gmail.com (ID: 31)
2025-07-10 19:46:05.696 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test13@gmail.com
2025-07-10 19:46:05.697 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:05.698 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:05.955 -03:00 [INF] Received HTTP response headers after 256.8141ms - 200
2025-07-10 19:46:05.956 -03:00 [INF] End processing HTTP request after 259.0701ms - 200
2025-07-10 19:46:05.957 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test13@gmail.com
2025-07-10 19:46:05.962 -03:00 [INF] Executed DbCommand (266ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:46:09.817 -03:00 [INF] ✅ Email enviado com sucesso para test13@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:46:09.819 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test13@gmail.com'
2025-07-10 19:46:09.819 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 13'
2025-07-10 19:46:09.820 -03:00 [INF] Usuário User 13 (test13@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:46:09.821 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:46:09.822 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 6814.4383ms
2025-07-10 19:46:09.822 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:09.823 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 6820.0046ms
2025-07-10 19:46:09.825 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:46:09.826 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:09.827 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:09.828 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test13@gmail.com'
2025-07-10 19:46:09.829 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 13'
2025-07-10 19:46:09.829 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:46:09.830 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.0382ms.
2025-07-10 19:46:09.831 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.2506ms
2025-07-10 19:46:09.832 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:09.832 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 7.3884ms
2025-07-10 19:46:09.850 -03:00 [INF] ✅ Email enviado com sucesso para test13@gmail.com - Assunto: 🔥 User 13, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:46:09.852 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 31
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.Microsoft.EntityFrameworkCore.Internal.IDbContextDependencies.get_StateManager()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.EntryWithoutDetectChanges(TEntity entity)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.Add(TEntity entity)
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 249
2025-07-10 19:46:10.088 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 92
2025-07-10 19:46:10.089 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:10.090 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:10.092 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test14@gmail.com, Nome: User 14
2025-07-10 19:46:10.093 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.74, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:46:10.094 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:46:10.094 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test14@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:46:10.362 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__ToLower_0='test14@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:46:10.632 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:46:10.903 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@p0='2025-07-10T22:46:10.6351239Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test14@gmail.com' (Nullable = false), @p3='192.168.100.74' (DbType = Object), @p4='User 14' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:46:10.6351240Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:46:11.171 -03:00 [INF] Executed DbCommand (266ms) [Parameters=[@p0='2025-07-10T22:46:10.9052672Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='32', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:46:11.173 -03:00 [INF] Novo lead criado: test14@gmail.com para manual-primeira-virada (ID: 32)
2025-07-10 19:46:11.173 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test14@gmail.com (ID: 32)
2025-07-10 19:46:11.174 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test14@gmail.com
2025-07-10 19:46:11.175 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:11.175 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:11.438 -03:00 [INF] Received HTTP response headers after 261.6745ms - 200
2025-07-10 19:46:11.439 -03:00 [INF] End processing HTTP request after 264.1373ms - 200
2025-07-10 19:46:11.440 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test14@gmail.com
2025-07-10 19:46:11.441 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:46:15.206 -03:00 [INF] ✅ Email enviado com sucesso para test14@gmail.com - Assunto: 🔥 User 14, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:46:15.328 -03:00 [INF] ✅ Email enviado com sucesso para test14@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:46:15.329 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test14@gmail.com'
2025-07-10 19:46:15.330 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 14'
2025-07-10 19:46:15.331 -03:00 [INF] Usuário User 14 (test14@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:46:15.331 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:46:15.332 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 5240.5521ms
2025-07-10 19:46:15.333 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:15.335 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:00000029": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:46:15.335 -03:00 [ERR] Failed executing DbCommand (127ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 User 14, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='test14@gmail.com' (Nullable = false), @p5='2025-07-10T22:46:15.2078019Z' (DbType = DateTime), @p6=NULL, @p7='32' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:46:15.343 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 5254.8042ms
2025-07-10 19:46:15.344 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:46:15.344 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:46:15.356 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 32
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 250
2025-07-10 19:46:15.356 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:15.359 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:15.360 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test14@gmail.com'
2025-07-10 19:46:15.361 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 14'
2025-07-10 19:46:15.362 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:46:15.363 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.5645ms.
2025-07-10 19:46:15.364 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 4.6041ms
2025-07-10 19:46:15.365 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:15.366 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 21.9271ms
2025-07-10 19:46:15.626 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 92
2025-07-10 19:46:15.629 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:15.629 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:15.631 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test15@gmail.com, Nome: User 15
2025-07-10 19:46:15.632 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.75, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:46:15.633 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:46:15.635 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test15@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:46:17.520 -03:00 [INF] Executed DbCommand (273ms) [Parameters=[@__ToLower_0='test15@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:46:17.790 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:46:18.061 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@p0='2025-07-10T22:46:17.7922139Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test15@gmail.com' (Nullable = false), @p3='192.168.100.75' (DbType = Object), @p4='User 15' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:46:17.7922139Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:46:18.335 -03:00 [INF] Executed DbCommand (271ms) [Parameters=[@p0='2025-07-10T22:46:18.0636022Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='33', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:46:18.336 -03:00 [INF] Novo lead criado: test15@gmail.com para manual-primeira-virada (ID: 33)
2025-07-10 19:46:18.337 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test15@gmail.com (ID: 33)
2025-07-10 19:46:18.338 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test15@gmail.com
2025-07-10 19:46:18.339 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:18.340 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:18.593 -03:00 [INF] Received HTTP response headers after 252.9475ms - 200
2025-07-10 19:46:18.594 -03:00 [INF] End processing HTTP request after 255.319ms - 200
2025-07-10 19:46:18.595 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test15@gmail.com
2025-07-10 19:46:18.603 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:46:22.425 -03:00 [INF] ✅ Email enviado com sucesso para test15@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:46:22.426 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test15@gmail.com'
2025-07-10 19:46:22.427 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 15'
2025-07-10 19:46:22.428 -03:00 [INF] Usuário User 15 (test15@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:46:22.428 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:46:22.429 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 6798.486ms
2025-07-10 19:46:22.430 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:22.431 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 6804.2562ms
2025-07-10 19:46:22.432 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:46:22.434 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:22.436 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:22.438 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test15@gmail.com'
2025-07-10 19:46:22.438 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 15'
2025-07-10 19:46:22.439 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:46:22.440 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.1129ms.
2025-07-10 19:46:22.441 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.4786ms
2025-07-10 19:46:22.441 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:22.442 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 9.8172ms
2025-07-10 19:46:22.458 -03:00 [INF] ✅ Email enviado com sucesso para test15@gmail.com - Assunto: 🔥 User 15, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:46:22.460 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 33
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.Microsoft.EntityFrameworkCore.Internal.IDbContextDependencies.get_StateManager()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.EntryWithoutDetectChanges(TEntity entity)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.Add(TEntity entity)
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 249
2025-07-10 19:46:22.696 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 92
2025-07-10 19:46:22.698 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:22.698 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:22.700 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: test16@gmail.com, Nome: User 16
2025-07-10 19:46:22.701 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.100.76, UserAgent: SuperBot/2.0 (Automated Testing Tool)
2025-07-10 19:46:22.702 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:46:22.703 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: test16@gmail.com, Slug: manual-primeira-virada
2025-07-10 19:46:22.972 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__ToLower_0='test16@gmail.com', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:46:23.242 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:46:23.510 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[@p0='2025-07-10T22:46:23.2450616Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='test16@gmail.com' (Nullable = false), @p3='192.168.100.76' (DbType = Object), @p4='User 16' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:46:23.2450619Z' (DbType = DateTime), @p11='SuperBot/2.0 (Automated Testing Tool)', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:46:23.779 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@p0='2025-07-10T22:46:23.5119053Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='34', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:46:23.780 -03:00 [INF] Novo lead criado: test16@gmail.com para manual-primeira-virada (ID: 34)
2025-07-10 19:46:23.781 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: test16@gmail.com (ID: 34)
2025-07-10 19:46:23.782 -03:00 [INF] Iniciando cadastro de usuário na newsletter: test16@gmail.com
2025-07-10 19:46:23.783 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:23.783 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:24.037 -03:00 [INF] Received HTTP response headers after 252.5497ms - 200
2025-07-10 19:46:24.038 -03:00 [INF] End processing HTTP request after 255.5149ms - 200
2025-07-10 19:46:24.039 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: test16@gmail.com
2025-07-10 19:46:24.048 -03:00 [INF] Executed DbCommand (266ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:46:27.803 -03:00 [INF] ✅ Email enviado com sucesso para test16@gmail.com - Assunto: 🔥 User 16, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:46:27.832 -03:00 [INF] ✅ Email enviado com sucesso para test16@gmail.com - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:46:27.833 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'test16@gmail.com'
2025-07-10 19:46:27.834 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'User 16'
2025-07-10 19:46:27.835 -03:00 [INF] Usuário User 16 (test16@gmail.com) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:46:27.836 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:46:27.837 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 5137.5692ms
2025-07-10 19:46:27.838 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:27.839 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:0000002D": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:46:27.839 -03:00 [ERR] Failed executing DbCommand (33ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 User 16, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='test16@gmail.com' (Nullable = false), @p5='2025-07-10T22:46:27.8051177Z' (DbType = DateTime), @p6=NULL, @p7='34' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:46:27.846 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 5149.8853ms
2025-07-10 19:46:27.847 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:46:27.848 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:46:27.859 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 34
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 250
2025-07-10 19:46:27.859 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:27.862 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:27.863 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'test16@gmail.com'
2025-07-10 19:46:27.864 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'User 16'
2025-07-10 19:46:27.865 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:46:27.866 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.0622ms.
2025-07-10 19:46:27.866 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.3724ms
2025-07-10 19:46:27.868 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:27.869 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 20.7383ms
2025-07-10 19:46:28.123 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 98
2025-07-10 19:46:28.125 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:28.126 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:28.128 -03:00 [WRN] Padrão de spam russo detectado no email: user1@tempmail.tk - Padrão: @tempmail
2025-07-10 19:46:28.129 -03:00 [WRN] 🤖 Email/Nome suspeito detectado - Email: user1@tempmail.tk, Nome: Normal User 1, IP: 192.168.101.11
2025-07-10 19:46:28.131 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:46:28.132 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 3.8659ms
2025-07-10 19:46:28.133 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:28.134 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 11.4978ms
2025-07-10 19:46:28.138 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:46:28.140 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:28.141 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:28.143 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'NULL'
2025-07-10 19:46:28.144 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'NULL'
2025-07-10 19:46:28.146 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:46:28.147 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.635ms.
2025-07-10 19:46:28.148 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 5.7671ms
2025-07-10 19:46:28.150 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:28.152 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 14.0917ms
2025-07-10 19:46:28.626 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 99
2025-07-10 19:46:28.627 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:28.628 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:28.630 -03:00 [WRN] Padrão de spam russo detectado no email: user2@fakeemail.ml - Padrão: .ml
2025-07-10 19:46:28.630 -03:00 [WRN] 🤖 Email/Nome suspeito detectado - Email: user2@fakeemail.ml, Nome: Normal User 2, IP: 192.168.101.12
2025-07-10 19:46:28.631 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:46:28.632 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 2.7669ms
2025-07-10 19:46:28.633 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:28.633 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 7.5664ms
2025-07-10 19:46:28.636 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:46:28.638 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:28.639 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:28.640 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'NULL'
2025-07-10 19:46:28.640 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'NULL'
2025-07-10 19:46:28.641 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:46:28.642 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.0346ms.
2025-07-10 19:46:28.643 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.5026ms
2025-07-10 19:46:28.644 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:28.645 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 8.3924ms
2025-07-10 19:46:29.092 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 98
2025-07-10 19:46:29.093 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:29.094 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:29.096 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: user3@spammail.ga, Nome: Normal User 3
2025-07-10 19:46:29.096 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.101.13, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) 3
2025-07-10 19:46:29.097 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:46:29.098 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: user3@spammail.ga, Slug: manual-primeira-virada
2025-07-10 19:46:30.993 -03:00 [INF] Executed DbCommand (274ms) [Parameters=[@__ToLower_0='user3@spammail.ga', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:46:31.260 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:46:31.527 -03:00 [INF] Executed DbCommand (265ms) [Parameters=[@p0='2025-07-10T22:46:31.2626864Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='user3@spammail.ga' (Nullable = false), @p3='192.168.101.13' (DbType = Object), @p4='Normal User 3' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:46:31.2626864Z' (DbType = DateTime), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64) 3', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:46:31.797 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@p0='2025-07-10T22:46:31.5295289Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='35', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:46:31.799 -03:00 [INF] Novo lead criado: user3@spammail.ga para manual-primeira-virada (ID: 35)
2025-07-10 19:46:31.800 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: user3@spammail.ga (ID: 35)
2025-07-10 19:46:31.802 -03:00 [INF] Iniciando cadastro de usuário na newsletter: user3@spammail.ga
2025-07-10 19:46:31.802 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:31.803 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:32.056 -03:00 [INF] Received HTTP response headers after 251.5066ms - 200
2025-07-10 19:46:32.057 -03:00 [INF] End processing HTTP request after 254.2709ms - 200
2025-07-10 19:46:32.057 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: user3@spammail.ga
2025-07-10 19:46:32.069 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:46:36.122 -03:00 [INF] ✅ Email enviado com sucesso para user3@spammail.ga - Assunto: 🔥 Normal User 3, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:46:36.395 -03:00 [INF] Executed DbCommand (271ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 Normal User 3, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='user3@spammail.ga' (Nullable = false), @p5='2025-07-10T22:46:36.1243014Z' (DbType = DateTime), @p6=NULL, @p7='35' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:46:36.495 -03:00 [INF] ✅ Email enviado com sucesso para user3@spammail.ga - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:46:36.496 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'user3@spammail.ga'
2025-07-10 19:46:36.497 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'Normal User 3'
2025-07-10 19:46:36.498 -03:00 [INF] Usuário Normal User 3 (user3@spammail.ga) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:46:36.500 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:46:36.501 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 7406.3783ms
2025-07-10 19:46:36.503 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:36.504 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:00000033": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:46:36.505 -03:00 [ERR] Failed executing DbCommand (107ms) [Parameters=[@p0='2025-07-10T22:46:36.3974318Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Email enviado: boas-vindas', @p3=NULL (DbType = Object), @p4='35', @p5='email_sent' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:46:36.513 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 7421.3676ms
2025-07-10 19:46:36.515 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:46:36.516 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:46:36.553 -03:00 [ERR] Erro ao registrar interação para lead 35: email_sent
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.RegistrarInteracaoAsync(Int32 leadId, String tipo, String descricao, Object dados) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 155
2025-07-10 19:46:36.553 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:36.556 -03:00 [INF] Email de boas-vindas enviado para user3@spammail.ga
2025-07-10 19:46:36.556 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:36.559 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'user3@spammail.ga'
2025-07-10 19:46:36.560 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'Normal User 3'
2025-07-10 19:46:36.561 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:46:36.562 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.3106ms.
2025-07-10 19:46:36.563 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 5.0431ms
2025-07-10 19:46:36.564 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:36.565 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 48.7178ms
2025-07-10 19:46:37.011 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 97
2025-07-10 19:46:37.013 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:37.013 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:37.016 -03:00 [INF] 🔄 INICIANDO PROCESSO DE CADASTRO - Email: user4@botmail.cf, Nome: Normal User 4
2025-07-10 19:46:37.016 -03:00 [INF] 🔍 DADOS CAPTURADOS - IP: 192.168.101.14, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) 4
2025-07-10 19:46:37.017 -03:00 [INF] 🔍 UTM PARAMETERS - Source: , Medium: , Campaign: 
2025-07-10 19:46:37.019 -03:00 [INF] 🚀 CHAMANDO _leadService.CriarLeadAsync - Email: user4@botmail.cf, Slug: manual-primeira-virada
2025-07-10 19:46:38.888 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@__ToLower_0='user4@botmail.cf', @__desafioSlug_1='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.desafio_slug, l.email, l.ip_address, l.nome, l.notas, l.opt_in, l.source_id, l.status, l.tags, l.updated_at, l.user_agent, l.utm_campaign, l.utm_content, l.utm_medium, l.utm_source, l.utm_term, l0.id, l0.ativo, l0.created_at, l0.descricao, l0.nome, l0.slug, l0.updated_at
FROM leads_system.leads AS l
LEFT JOIN leads_system.lead_sources AS l0 ON l.source_id = l0.id
WHERE l.email = @__ToLower_0 AND l.desafio_slug = @__desafioSlug_1
LIMIT 1
2025-07-10 19:46:39.156 -03:00 [INF] Executed DbCommand (266ms) [Parameters=[@__8__locals1_request_DesafioSlug_0='manual-primeira-virada'], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.ativo, l.created_at, l.descricao, l.nome, l.slug, l.updated_at
FROM leads_system.lead_sources AS l
WHERE l.slug = @__8__locals1_request_DesafioSlug_0
LIMIT 1
2025-07-10 19:46:39.426 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@p0='2025-07-10T22:46:39.1587582Z' (DbType = DateTime), @p1='manual-primeira-virada' (Nullable = false), @p2='user4@botmail.cf' (Nullable = false), @p3='192.168.101.14' (DbType = Object), @p4='Normal User 4' (Nullable = false), @p5=NULL, @p6='True', @p7='9' (Nullable = true), @p8='novo' (Nullable = false), @p9=NULL (DbType = Object), @p10='2025-07-10T22:46:39.1587583Z' (DbType = DateTime), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64) 4', @p12=NULL, @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.leads (created_at, desafio_slug, email, ip_address, nome, notas, opt_in, source_id, status, tags, updated_at, user_agent, utm_campaign, utm_content, utm_medium, utm_source, utm_term)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING id;
2025-07-10 19:46:39.698 -03:00 [INF] Executed DbCommand (269ms) [Parameters=[@p0='2025-07-10T22:46:39.4286338Z' (DbType = DateTime), @p1='System.Text.Json.JsonDocument' (DbType = Object), @p2='Lead se cadastrou no desafio', @p3=NULL (DbType = Object), @p4='36', @p5='form_submitted' (Nullable = false), @p6=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.lead_interactions (created_at, dados, descricao, ip_address, lead_id, tipo, user_agent)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2025-07-10 19:46:39.699 -03:00 [INF] Novo lead criado: user4@botmail.cf para manual-primeira-virada (ID: 36)
2025-07-10 19:46:39.700 -03:00 [INF] 💰 Lead criado com sucesso para Manual da Primeira Virada: user4@botmail.cf (ID: 36)
2025-07-10 19:46:39.702 -03:00 [INF] Iniciando cadastro de usuário na newsletter: user4@botmail.cf
2025-07-10 19:46:39.702 -03:00 [INF] Start processing HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:39.703 -03:00 [INF] Sending HTTP request POST https://n8n.diogocosta.dev/webhook/colocar-na-lista
2025-07-10 19:46:39.968 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT e.id, e.assunto, e.ativo, e.corpo_html, e.corpo_texto, e.created_at, e.nome, e.slug, e.updated_at, e.variaveis
FROM leads_system.email_templates AS e
WHERE e.slug = 'boas-vindas-desafio' AND e.ativo
LIMIT 1
2025-07-10 19:46:40.543 -03:00 [INF] Received HTTP response headers after 839.0464ms - 200
2025-07-10 19:46:40.544 -03:00 [INF] End processing HTTP request after 841.5094ms - 200
2025-07-10 19:46:40.544 -03:00 [INF] Usuário cadastrado com sucesso na newsletter: user4@botmail.cf
2025-07-10 19:46:44.948 -03:00 [INF] ✅ Email enviado com sucesso para user4@botmail.cf - Assunto: 🔥 Normal User 4, seu lugar no Manual Primeira Virada está garantido!
2025-07-10 19:46:45.168 -03:00 [INF] ✅ Email enviado com sucesso para user4@botmail.cf - Assunto: Seu Manual da Primeira Virada está pronto para download!
2025-07-10 19:46:45.169 -03:00 [INF] 🔍 DEBUG CADASTRO - Email salvo no TempData: 'user4@botmail.cf'
2025-07-10 19:46:45.170 -03:00 [INF] 🔍 DEBUG CADASTRO - Nome salvo no TempData: 'Normal User 4'
2025-07-10 19:46:45.171 -03:00 [INF] Usuário Normal User 4 (user4@botmail.cf) se cadastrou para receber o Manual da Primeira Virada
2025-07-10 19:46:45.172 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:46:45.173 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 8158.1118ms
2025-07-10 19:46:45.174 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:45.175 -03:00 [ERR] Connection id "0HNE00A8C3CV6", Request id "0HNE00A8C3CV6:00000035": An unhandled exception was thrown by the application.
Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.NotSupportedException:  This method may not be called when another read operation is pending.
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Consume(Boolean async, Exception firstException)
   at Npgsql.NpgsqlDataReader.Close(Boolean async, Boolean connectionClosing, Boolean isDisposing)
   at Npgsql.Internal.NpgsqlConnector.CloseOngoingOperations(Boolean async)
   at Npgsql.NpgsqlConnection.CloseAsync(Boolean async)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ResetStateAsync(Boolean disposeDbConnection)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.EntityFrameworkCore.DbContext.DisposeAsync()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.<DisposeAsync>g__Await|26_0(Int32 i, ValueTask vt, List`1 toDispose)
   at Microsoft.AspNetCore.Http.Features.RequestServicesFeature.<DisposeAsync>g__Awaited|9_0(RequestServicesFeature servicesFeature, ValueTask vt)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.<FireOnCompleted>g__ProcessEvents|242_0(HttpProtocol protocol, Stack`1 events)
2025-07-10 19:46:45.175 -03:00 [ERR] Failed executing DbCommand (225ms) [Parameters=[@p0=NULL (DbType = DateTime), @p1='🔥 Normal User 4, seu lugar no Manual Primeira Virada está garantido!' (Nullable = false), @p2=NULL (DbType = DateTime), @p3=NULL (DbType = DateTime), @p4='user4@botmail.cf' (Nullable = false), @p5='2025-07-10T22:46:44.9497396Z' (DbType = DateTime), @p6=NULL, @p7='36' (Nullable = true), @p8=NULL (DbType = DateTime), @p9='enviado' (Nullable = false), @p10='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO leads_system.email_logs (aberto_em, assunto, bounce_em, clicado_em, email_to, enviado_em, erro_msg, lead_id, spam_em, status, template_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10)
RETURNING id;
2025-07-10 19:46:45.183 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 8171.74ms
2025-07-10 19:46:45.185 -03:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.NpgsqlException (0x80004005): Exception while reading from stream
 ---> System.IO.IOException: Unable to read data from the transport connection: A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo..
 ---> System.Net.Sockets.SocketException (995): A operação de E/S foi anulada devido a uma saída de thread ou a uma requisição de aplicativo.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at Npgsql.Internal.NpgsqlReadBuffer.<Ensure>g__EnsureLong|55_0(NpgsqlReadBuffer buffer, Int32 count, Boolean async, Boolean readingNotifications)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-07-10 19:46:45.187 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:46:45.198 -03:00 [ERR] Erro ao enviar email de boas-vindas para lead 36
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'ApplicationDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at site.diogocosta.dev.Data.ApplicationDbContext.SaveChangesAsync(CancellationToken cancellationToken) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Data\ApplicationDbContext.cs:line 214
   at site.diogocosta.dev.Servicos.LeadService.EnviarEmailBoasVindasAsync(LeadModel lead) in F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev\Servicos\LeadService.cs:line 250
2025-07-10 19:46:45.198 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:45.202 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:45.205 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'user4@botmail.cf'
2025-07-10 19:46:45.206 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'Normal User 4'
2025-07-10 19:46:45.207 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:46:45.208 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.3537ms.
2025-07-10 19:46:45.209 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 5.1296ms
2025-07-10 19:46:45.210 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:45.211 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 24.3209ms
2025-07-10 19:46:45.665 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 98
2025-07-10 19:46:45.667 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:45.668 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:45.670 -03:00 [WRN] Padrão de spam russo detectado no email: user5@tempmail.tk - Padrão: @tempmail
2025-07-10 19:46:45.671 -03:00 [WRN] 🤖 Email/Nome suspeito detectado - Email: user5@tempmail.tk, Nome: Normal User 5, IP: 192.168.101.15
2025-07-10 19:46:45.672 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:46:45.673 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 3.3225ms
2025-07-10 19:46:45.674 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:45.674 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 9.0233ms
2025-07-10 19:46:45.676 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:46:45.678 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:45.678 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:45.680 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'NULL'
2025-07-10 19:46:45.680 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'NULL'
2025-07-10 19:46:45.681 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:46:45.682 -03:00 [INF] Executed ViewResult - view Obrigado executed in 0.9171ms.
2025-07-10 19:46:45.683 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 3.7296ms
2025-07-10 19:46:45.685 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:45.686 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 9.9046ms
2025-07-10 19:46:46.136 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - application/x-www-form-urlencoded 99
2025-07-10 19:46:46.138 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:46.139 -03:00 [INF] Route matched with {action = "Cadastrar", controller = "Desbloqueio"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Cadastrar(site.diogocosta.dev.Models.DesbloqueioModel) on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:46.140 -03:00 [WRN] Padrão de spam russo detectado no email: user6@fakeemail.ml - Padrão: .ml
2025-07-10 19:46:46.141 -03:00 [WRN] 🤖 Email/Nome suspeito detectado - Email: user6@fakeemail.ml, Nome: Normal User 6, IP: 192.168.101.16
2025-07-10 19:46:46.142 -03:00 [INF] Executing RedirectResult, redirecting to /obrigado-desbloqueio.
2025-07-10 19:46:46.143 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev) in 2.8461ms
2025-07-10 19:46:46.144 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Cadastrar (site.diogocosta.dev)'
2025-07-10 19:46:46.144 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/Desbloqueio/Cadastrar - 302 0 null 8.515ms
2025-07-10 19:46:46.146 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - application/x-www-form-urlencoded null
2025-07-10 19:46:46.147 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:46.148 -03:00 [INF] Route matched with {action = "Obrigado", controller = "Desbloqueio"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Obrigado() on controller site.diogocosta.dev.Controllers.DesbloqueioController (site.diogocosta.dev).
2025-07-10 19:46:46.149 -03:00 [INF] 🔍 DEBUG OBRIGADO - Email recuperado do TempData: 'NULL'
2025-07-10 19:46:46.150 -03:00 [INF] 🔍 DEBUG OBRIGADO - Nome recuperado do TempData: 'NULL'
2025-07-10 19:46:46.151 -03:00 [INF] Executing ViewResult, running view Obrigado.
2025-07-10 19:46:46.153 -03:00 [INF] Executed ViewResult - view Obrigado executed in 1.5414ms.
2025-07-10 19:46:46.154 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev) in 5.0464ms
2025-07-10 19:46:46.155 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.DesbloqueioController.Obrigado (site.diogocosta.dev)'
2025-07-10 19:46:46.156 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/obrigado-desbloqueio - 200 null text/html; charset=utf-8 10.3853ms
2025-07-10 19:47:18.307 -03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/antispam?page=1&pageSize=10 - null null
2025-07-10 19:47:18.309 -03:00 [INF] Executing endpoint 'site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev)'
2025-07-10 19:47:18.310 -03:00 [INF] Route matched with {action = "GetRules", controller = "AntiSpam"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[site.diogocosta.dev.Models.AntiSpamRuleResponse]]] GetRules(System.String, System.Nullable`1[System.Boolean], System.String, Int32, Int32) on controller site.diogocosta.dev.Controllers.AntiSpamController (site.diogocosta.dev).
2025-07-10 19:47:20.185 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM public.antispam_rules AS a
2025-07-10 19:47:20.455 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@__p_1='10', @__p_0='0'], CommandType='"Text"', CommandTimeout='30']
SELECT a.id AS "Id", a.rule_type AS "RuleType", a.rule_value AS "RuleValue", a.description AS "Description", a.severity AS "Severity", a.is_active AS "IsActive", a.is_regex AS "IsRegex", a.created_at AS "CreatedAt", a.updated_at AS "UpdatedAt", a.created_by AS "CreatedBy", a.detection_count AS "DetectionCount", a.last_detection AS "LastDetection"
FROM public.antispam_rules AS a
ORDER BY a.created_at DESC
LIMIT @__p_1 OFFSET @__p_0
2025-07-10 19:47:20.457 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[site.diogocosta.dev.Models.AntiSpamRuleResponse, site.diogocosta.dev, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-10 19:47:20.458 -03:00 [INF] Executed action site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev) in 2146.6485ms
2025-07-10 19:47:20.459 -03:00 [INF] Executed endpoint 'site.diogocosta.dev.Controllers.AntiSpamController.GetRules (site.diogocosta.dev)'
2025-07-10 19:47:20.460 -03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/antispam?page=1&pageSize=10 - 200 null application/json; charset=utf-8 2153.2186ms
2025-07-10 19:48:29.900 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@__recentCutoff_0='2025-07-10T22:18:29.6318233Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.dados, l.descricao, l.ip_address, l.lead_id, l.tipo, l.user_agent
FROM leads_system.lead_interactions AS l
WHERE l.created_at >= @__recentCutoff_0
2025-07-10 19:53:31.792 -03:00 [INF] Executed DbCommand (266ms) [Parameters=[@__recentCutoff_0='2025-07-10T22:23:29.9149563Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.dados, l.descricao, l.ip_address, l.lead_id, l.tipo, l.user_agent
FROM leads_system.lead_interactions AS l
WHERE l.created_at >= @__recentCutoff_0
2025-07-10 19:58:33.689 -03:00 [INF] Executed DbCommand (268ms) [Parameters=[@__recentCutoff_0='2025-07-10T22:28:31.8097814Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.dados, l.descricao, l.ip_address, l.lead_id, l.tipo, l.user_agent
FROM leads_system.lead_interactions AS l
WHERE l.created_at >= @__recentCutoff_0
2025-07-10 20:03:35.584 -03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__recentCutoff_0='2025-07-10T22:33:33.7047838Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.dados, l.descricao, l.ip_address, l.lead_id, l.tipo, l.user_agent
FROM leads_system.lead_interactions AS l
WHERE l.created_at >= @__recentCutoff_0
2025-07-10 20:09:48.764 -03:00 [INF] Sistema iniciado em 10/07/2025 20:09:48
2025-07-10 20:09:48.818 -03:00 [INF] 🤖 Bot Detector Background Service iniciado!
2025-07-10 20:09:48.820 -03:00 [INF] 📊 Configurações: IP Threshold=10, UserAgent Threshold=15, Análise a cada "00:05:00"
2025-07-10 20:09:49.310 -03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-10 20:09:49.632 -03:00 [INF] BotDetectorBackgroundService iniciado
2025-07-10 20:09:49.653 -03:00 [INF] Now listening on: http://localhost:5000
2025-07-10 20:09:49.654 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-10 20:09:49.654 -03:00 [INF] Hosting environment: Development
2025-07-10 20:09:49.655 -03:00 [INF] Content root path: F:\Projetos\Serviço de Pagamento\site.diogocosta.dev\site.diogocosta.dev
2025-07-10 20:09:51.900 -03:00 [INF] Executed DbCommand (299ms) [Parameters=[@__recentCutoff_0='2025-07-10T22:39:48.9142035Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT l.id, l.created_at, l.dados, l.descricao, l.ip_address, l.lead_id, l.tipo, l.user_agent
FROM leads_system.lead_interactions AS l
WHERE l.created_at >= @__recentCutoff_0
